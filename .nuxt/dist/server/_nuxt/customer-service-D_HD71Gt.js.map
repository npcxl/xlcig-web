{"version":3,"file":"customer-service-D_HD71Gt.js","sources":["../../../../pages/customer-service.vue"],"sourcesContent":["<template>\n  <div class=\"min-h-screen bg-gradient-to-br from-gray-900 via-slate-900 to-black\">\n    <!-- èƒŒæ™¯è£…é¥° -->\n    <div class=\"fixed inset-0 pointer-events-none\">\n      <div\n        class=\"absolute top-20 left-20 w-96 h-96 bg-gradient-to-r from-cyan-500/20 to-blue-500/20 rounded-full filter blur-3xl animate-pulse\">\n      </div>\n      <div\n        class=\"absolute bottom-20 right-20 w-80 h-80 bg-gradient-to-r from-purple-500/20 to-pink-500/20 rounded-full filter blur-3xl animate-pulse delay-1000\">\n      </div>\n    </div>\n\n    <!-- å¯¼èˆªæ  -->\n    <AppHeader :show-back-button=\"false\" :show-nav-menu=\"true\" :show-breadcrumb=\"true\" :show-location=\"false\"\n      :show-search-button=\"false\" :show-notification-button=\"true\" :show-decorations=\"false\" current-page-title=\"åœ¨çº¿å®¢æœ\"\n      logo-size=\"medium\" />\n\n    <!-- é¡µé¢å¤´éƒ¨ -->\n    <section class=\"relative z-10\">\n      <div class=\"container mx-auto px-6 py-8\">\n        <div\n          class=\"glass-card-dark rounded-2xl p-8 border border-cyan-500/30 shadow-2xl shadow-cyan-500/20 animate-fade-in-up\">\n          <div class=\"flex items-center justify-between\">\n            <div>\n              <h1 class=\"text-4xl font-bold text-white mb-3 flex items-center gap-3\">\n                <i class=\"bi bi-headset text-cyan-400 text-3xl animate-bounce-gentle\"></i>\n                åœ¨çº¿å®¢æœ\n              </h1>\n              <p class=\"text-gray-300 text-lg\">ä¸“ä¸šçš„å®¢æœå›¢é˜Ÿéšæ—¶ä¸ºæ‚¨æä¾›å¸®åŠ©</p>\n            </div>\n            <!-- æœåŠ¡çŠ¶æ€å’Œå·¥å…· -->\n            <div class=\"flex items-center gap-4\">\n              <!-- æœåŠ¡çŠ¶æ€ -->\n              <div class=\"flex items-center gap-6\">\n                <div class=\"flex items-center gap-2\">\n                  <div class=\"w-3 h-3 rounded-full animate-pulse\"\n                    :class=\"serviceStatus.adminOnline ? 'bg-green-500' : 'bg-red-500'\"></div>\n                  <span class=\"text-sm text-gray-300\">\n                    {{ serviceStatus.adminOnline ? 'å®¢æœåœ¨çº¿' : 'æš‚æ— å®¢æœåœ¨çº¿' }}\n                  </span>\n                </div>\n              </div>\n              <!-- å·¥å…·æŒ‰é’® -->\n              <div class=\"flex items-center gap-2\">\n                <button v-if=\"unreadCount > 0\" @click=\"markAllMessagesAsRead\"\n                  class=\"px-4 py-2 text-sm font-medium bg-cyan-600 hover:bg-cyan-500 text-white rounded-lg transition-all duration-300 flex items-center gap-2 hover:scale-105 active:scale-95\">\n                  <i class=\"bi bi-check2-all\"></i>\n                  æ ‡è®°å·²è¯» ({{ unreadCount }})\n                </button>\n                <button @click=\"loadChatSessions\"\n                  class=\"px-4 py-2 text-sm font-medium border border-gray-600 hover:border-cyan-500 text-gray-300 hover:text-white rounded-lg transition-all duration-300 flex items-center gap-2 hover:scale-105 active:scale-95\">\n                  <i class=\"bi bi-arrow-clockwise\"></i>\n                  åˆ·æ–°\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </section>\n\n    <!-- èŠå¤©å·¥å…·æ  -->\n    <section class=\"relative z-10\">\n      <div class=\"container mx-auto px-6 py-4\">\n        <div\n          class=\"glass-card-dark rounded-2xl p-6 border border-cyan-500/30 shadow-2xl shadow-cyan-500/20 animate-fade-in-up\">\n          <div class=\"flex flex-wrap items-center justify-between gap-4\">\n            <div class=\"flex items-center gap-4\">\n              <div class=\"flex items-center gap-2\">\n                <i class=\"bi bi-chat-dots text-cyan-400\"></i>\n                <span class=\"text-white font-medium\">å½“å‰æ¨¡å¼ï¼š</span>\n                <span class=\"text-cyan-300\">\n                  {{ selectedSession ? `ä¸ ${selectedSession.user_nickname || selectedSession.user_name || 'ç”¨æˆ·'} å¯¹è¯` :\n                  'å®¢æœå›¢é˜Ÿæ¨¡å¼' }}\n                </span>\n              </div>\n              <div v-if=\"selectedSession\" class=\"flex items-center gap-2\">\n                <div class=\"w-2 h-2 rounded-full bg-green-500 animate-pulse\"></div>\n                <span class=\"text-sm text-gray-400\">ç”¨æˆ·å¯¹è¯ä¸­</span>\n              </div>\n            </div>\n            <div class=\"flex items-center gap-2\">\n              <div class=\"flex items-center gap-2 text-sm text-gray-400\">\n                <i class=\"bi bi-people\"></i>\n                <span>ä¼šè¯: {{ sessions.length }}</span>\n              </div>\n              <div class=\"flex items-center gap-2 text-sm text-gray-400\">\n                <i class=\"bi bi-chat-left-dots\"></i>\n                <span>æ¶ˆæ¯: {{ messages.length }}</span>\n              </div>\n              <div class=\"flex items-center gap-2\">\n                <div class=\"w-2 h-2 rounded-full animate-pulse\" :class=\"isConnected ? 'bg-green-500' : 'bg-red-500'\">\n                </div>\n                <span class=\"text-xs text-gray-400\">{{ isConnected ? 'å·²è¿æ¥' : 'è¿æ¥ä¸­...' }}</span>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </section>\n\n    <!-- ä¸»è¦å†…å®¹åŒº -->\n    <main class=\"container mx-auto px-6 py-8 relative z-10\">\n      <!-- èŠå¤©ä¸»ä½“ -->\n      <div class=\"grid grid-cols-1 xl:grid-cols-4 gap-6\">\n        <!-- ä¼šè¯åˆ—è¡¨ -->\n        <div class=\"xl:col-span-1\">\n          <div\n            class=\"glass-card-dark rounded-2xl border border-cyan-500/30 shadow-2xl shadow-cyan-500/20 overflow-hidden animate-fade-in-left h-[750px] flex flex-col\">\n            <!-- ä¼šè¯åˆ—è¡¨å¤´éƒ¨ -->\n            <div class=\"px-6 py-4 border-b border-gray-700/50 bg-gray-800/30\">\n              <div class=\"flex items-center justify-between\">\n                <div>\n                  <h3 class=\"text-lg font-semibold text-white mb-1 flex items-center gap-2\">\n                    <i class=\"bi bi-chat-left-text text-cyan-400\"></i>\n                    å¯¹è¯åˆ—è¡¨\n                  </h3>\n                  <p class=\"text-xs text-gray-400\">\n                    {{ sessions.length }} ä¸ªä¼šè¯\n                    <span v-if=\"selectedSession\" class=\"text-cyan-400 ml-2\">\n                      Â· å·²é€‰ä¸­ {{ selectedSession.user_nickname || selectedSession.user_name || `ç”¨æˆ·\n                      #${selectedSession.user_id}` }}\n                    </span>\n                  </p>\n                </div>\n                <div class=\"flex items-center gap-2\">\n                  <!-- è¿”å›å®¢æœæ¨¡å¼æŒ‰é’® -->\n                  <button v-if=\"selectedSession\" @click=\"backToCustomerService\"\n                    class=\"p-2 text-gray-400 hover:text-cyan-300 hover:bg-gray-700/50 rounded-lg transition-all duration-300 hover:scale-110 active:scale-95\"\n                    title=\"è¿”å›å®¢æœæ¨¡å¼\">\n                    <i class=\"bi bi-arrow-left text-lg\"></i>\n                  </button>\n                  <!-- åˆ·æ–°æŒ‰é’® -->\n                  <button @click=\"loadChatSessions\"\n                    class=\"p-2 text-gray-400 hover:text-cyan-300 hover:bg-gray-700/50 rounded-lg transition-all duration-300 hover:scale-110 active:scale-95\"\n                    title=\"åˆ·æ–°åˆ—è¡¨\">\n                    <i class=\"bi bi-arrow-clockwise text-lg\"></i>\n                  </button>\n                </div>\n              </div>\n            </div>\n\n            <!-- ä¼šè¯åˆ—è¡¨å†…å®¹ -->\n            <div class=\"flex-1 overflow-y-auto\">\n              <div v-if=\"sessions.length === 0\"\n                class=\"flex flex-col items-center justify-center h-full text-center p-8\">\n                <div\n                  class=\"w-20 h-20 bg-gradient-to-br from-gray-700/50 to-gray-800/50 rounded-full flex items-center justify-center mb-6\">\n                  <i class=\"bi bi-chat-dots text-3xl text-gray-500\"></i>\n                </div>\n                <h4 class=\"text-xl font-semibold text-white mb-3\">æš‚æ— å¯¹è¯</h4>\n                <p class=\"text-gray-400 text-sm leading-relaxed\">ç­‰å¾…ç”¨æˆ·å¼€å§‹å¯¹è¯<br>æˆ–ä»å®¢æœå›¢é˜Ÿæ¨¡å¼å¼€å§‹</p>\n              </div>\n\n              <div v-else class=\"p-4 space-y-3\">\n                <div v-for=\"(session, index) in sessions\" :key=\"session.id\" @click=\"selectSession(session)\"\n                  class=\"relative p-4 rounded-xl cursor-pointer transition-all duration-300 group hover:scale-[1.01] animate-fade-in-up border border-transparent hover:border-gray-600/50\"\n                  :class=\"[\n                    selectedSession?.id === session.id\n                      ? 'session-selected border-cyan-500/50'\n                      : 'hover:bg-gray-800/30'\n                  ]\" :style=\"{ animationDelay: `${index * 50}ms` }\">\n                  <!-- é€‰ä¸­çŠ¶æ€æŒ‡ç¤ºå™¨ -->\n                  <div v-if=\"selectedSession?.id === session.id\"\n                    class=\"absolute top-3 left-3 w-3 h-3 bg-cyan-400 rounded-full animate-pulse shadow-lg\"></div>\n                  <!-- æœªè¯»æ¶ˆæ¯æŒ‡ç¤ºå™¨ -->\n                  <div v-if=\"session.unread_count > 0\"\n                    class=\"absolute top-3 right-3 min-w-[20px] h-5 bg-red-500 rounded-full flex items-center justify-center px-1\">\n                    <span class=\"text-xs text-white font-semibold\">{{ session.unread_count > 99 ? '99+' :\n                      session.unread_count }}</span>\n                  </div>\n\n                  <!-- ç”¨æˆ·ä¿¡æ¯ -->\n                  <div class=\"flex items-center space-x-4\">\n                    <!-- ç”¨æˆ·å¤´åƒ -->\n                    <div class=\"relative flex-shrink-0\">\n                      <div class=\"w-14 h-14 rounded-xl overflow-hidden border-2 transition-all duration-300 shadow-lg\"\n                        :class=\"selectedSession?.id === session.id ? 'border-cyan-400/70 shadow-cyan-400/20' : 'border-gray-700/50'\">\n                        <img v-if=\"session.user_avatar\" :src=\"session.user_avatar\" :alt=\"session.user_nickname || 'ç”¨æˆ·'\"\n                          class=\"w-full h-full object-cover\" @error=\"$event.target.style.display = 'none'\" />\n                        <div v-else\n                          class=\"w-full h-full bg-gradient-to-br from-gray-600 to-gray-700 flex items-center justify-center\">\n                          <i class=\"bi bi-person text-white text-xl\"></i>\n                        </div>\n                      </div>\n                      <!-- åœ¨çº¿çŠ¶æ€æŒ‡ç¤ºå™¨ -->\n                      <div\n                        class=\"absolute -bottom-1 -right-1 w-5 h-5 bg-gray-800 rounded-full flex items-center justify-center border border-gray-700\">\n                        <div class=\"w-3 h-3 rounded-full\" \n                             :class=\"session.isOnline ? 'bg-green-500 animate-pulse' : 'bg-gray-500'\"></div>\n                      </div>\n                    </div>\n\n                    <!-- ä¼šè¯ä¿¡æ¯ -->\n                    <div class=\"flex-1 min-w-0\">\n                      <div class=\"flex items-center justify-between mb-2\">\n                        <h4 class=\"text-white font-semibold text-base truncate\">\n                          {{ session.user_nickname || session.user_name || `ç”¨æˆ· #${session.user_id}` }}\n                        </h4>\n                        <span class=\"text-xs text-gray-500 flex-shrink-0 ml-2\">\n                          {{ formatTime(session.last_message_time || session.started_at) }}\n                        </span>\n                      </div>\n\n                      <!-- æœ€åæ¶ˆæ¯ -->\n                      <div class=\"mb-2\">\n                        <p class=\"text-sm text-gray-400 truncate leading-relaxed\">\n                          {{ session.last_message || 'ç­‰å¾…å¼€å§‹å¯¹è¯...' }}\n                        </p>\n                      </div>\n\n                      <!-- çŠ¶æ€ä¿¡æ¯ -->\n                      <div class=\"flex items-center justify-between\">\n                        <div class=\"flex items-center space-x-2\">\n                          <span class=\"text-xs px-2 py-1 rounded-lg font-medium\"\n                            :class=\"getSessionStatusClass(session.status)\">\n                            {{ getSessionStatusText(session.status) }}\n                          </span>\n                          <!-- è¯„åˆ† -->\n                          <div v-if=\"session.rating\" class=\"flex items-center\">\n                            <div class=\"flex mr-1\">\n                              <i v-for=\"i in 5\" :key=\"i\"\n                                :class=\"i <= session.rating ? 'text-yellow-400' : 'text-gray-600'\"\n                                class=\"bi bi-star-fill text-xs\"></i>\n                            </div>\n                            <span class=\"text-xs text-gray-500\">{{ session.rating }}.0</span>\n                          </div>\n                        </div>\n\n                        <!-- åœ¨çº¿çŠ¶æ€ -->\n                        <div class=\"flex items-center gap-1\">\n                          <div class=\"w-2 h-2 rounded-full\" \n                               :class=\"session.isOnline ? 'bg-green-500 animate-pulse' : 'bg-gray-500'\"></div>\n                          <span class=\"text-xs\" \n                                :class=\"session.isOnline ? 'text-green-400' : 'text-gray-400'\">\n                            {{ session.isOnline ? 'åœ¨çº¿' : 'ç¦»çº¿' }}\n                          </span>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <!-- ä¸»èŠå¤©åŒºåŸŸ -->\n        <div class=\"xl:col-span-3\">\n          <div\n            class=\"glass-card-dark rounded-2xl border border-cyan-500/30 shadow-2xl shadow-cyan-500/20 overflow-hidden animate-fade-in-right h-[750px] flex flex-col\">\n            <!-- èŠå¤©å¤´éƒ¨ -->\n            <div class=\"px-6 py-4 border-b border-gray-700/50 bg-gray-800/30\">\n              <div class=\"flex items-center justify-between\">\n                <div class=\"flex items-center gap-4\">\n                  <!-- èŠå¤©å¯¹è±¡å¤´åƒ -->\n                  <div\n                    class=\"w-12 h-12 rounded-xl flex items-center justify-center overflow-hidden border-2 shadow-lg transition-all duration-300\"\n                    :class=\"currentChatUser.isCustomerService ? 'border-cyan-500/50' : 'border-gray-600/50'\">\n                    <img v-if=\"currentChatUser.avatar\" :src=\"currentChatUser.avatar\" :alt=\"currentChatUser.name\"\n                      class=\"w-full h-full object-cover\" @error=\"handleAvatarError\" />\n                    <div v-else class=\"w-full h-full flex items-center justify-center animate-pulse-gentle\" :class=\"currentChatUser.isCustomerService\n                      ? 'bg-gradient-to-r from-cyan-500 to-blue-500'\n                      : 'bg-gradient-to-r from-gray-500 to-gray-600'\">\n                      <i class=\"text-white text-xl\"\n                        :class=\"currentChatUser.isCustomerService ? 'bi bi-headset' : 'bi bi-person'\"></i>\n                    </div>\n                  </div>\n                  <div>\n                    <h3 class=\"text-xl font-semibold text-white flex items-center gap-2\">\n                      {{ currentChatUser.name }}\n                      <i v-if=\"currentChatUser.isCustomerService\"\n                        class=\"bi bi-patch-check-fill text-cyan-400 text-lg\"></i>\n                    </h3>\n                    <p class=\"text-sm text-gray-400 flex items-center gap-2\">\n                    <div class=\"w-2 h-2 rounded-full\"\n                      :class=\"currentChatUser.isCustomerService \n                        ? (isConnected ? 'bg-green-500 animate-pulse' : 'bg-gray-500')\n                        : (currentChatUser.isOnline ? 'bg-green-500 animate-pulse' : 'bg-gray-500')\">\n                    </div>\n                    {{ currentChatUser.status }}\n                    </p>\n                  </div>\n                </div>\n                <div class=\"flex items-center gap-3\">\n                  <!-- è¿æ¥çŠ¶æ€ -->\n                  <div class=\"flex items-center gap-2 px-3 py-1 rounded-lg bg-gray-700/30\">\n                    <div class=\"w-2 h-2 rounded-full animate-pulse\"\n                      :class=\"isConnected ? 'bg-green-500' : 'bg-red-500'\"></div>\n                    <span class=\"text-xs text-gray-400 font-medium\">{{ isConnected ? 'å·²è¿æ¥' : 'è¿æ¥ä¸­...' }}</span>\n                  </div>\n                  <!-- åŠŸèƒ½æŒ‰é’® -->\n                  <div class=\"flex items-center gap-1\">\n                    <button\n                      class=\"p-2 text-gray-400 hover:text-white hover:bg-gray-700/50 rounded-lg transition-all duration-300 hover:scale-110 active:scale-95\"\n                      title=\"è¯­éŸ³é€šè¯\">\n                      <i class=\"bi bi-telephone text-lg\"></i>\n                    </button>\n                    <button\n                      class=\"p-2 text-gray-400 hover:text-white hover:bg-gray-700/50 rounded-lg transition-all duration-300 hover:scale-110 active:scale-95\"\n                      title=\"æ›´å¤šé€‰é¡¹\">\n                      <i class=\"bi bi-three-dots text-lg\"></i>\n                    </button>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            <!-- èŠå¤©æ¶ˆæ¯åŒºåŸŸ -->\n            <div class=\"flex-1 overflow-y-auto p-6\" ref=\"messagesContainer\">\n              <!-- æ¬¢è¿æ¶ˆæ¯ -->\n              <div v-if=\"messages.length === 0\" class=\"text-center py-16\">\n                <div\n                  class=\"w-24 h-24 bg-gradient-to-r from-cyan-500/20 to-blue-500/20 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-2xl\">\n                  <i class=\"bi bi-chat-heart text-4xl text-cyan-400\"></i>\n                </div>\n                <h3 class=\"text-2xl font-bold text-white mb-3\">\n                  {{ selectedSession ? `ä¸ ${selectedSession.user_nickname || selectedSession.user_name || `ç”¨æˆ·\n                  #${selectedSession.user_id}`} çš„å¯¹è¯` : 'æ¬¢è¿ä½¿ç”¨åœ¨çº¿å®¢æœ' }}\n                </h3>\n                <p class=\"text-gray-400 mb-8 text-lg leading-relaxed max-w-md mx-auto\">\n                  {{ selectedSession ? 'æ‚¨æ­£åœ¨ä¸è¯¥ç”¨æˆ·è¿›è¡Œç§äººå¯¹è¯ï¼Œå¯ä»¥å®æ—¶äº¤æµè§£å†³é—®é¢˜' : 'æœ‰ä»»ä½•é—®é¢˜éƒ½å¯ä»¥åœ¨è¿™é‡Œä¸æˆ‘ä»¬æ²Ÿé€šï¼Œæ‚¨ä¹Ÿå¯ä»¥ä»å·¦ä¾§é€‰æ‹©ç‰¹å®šç”¨æˆ·è¿›è¡Œå¯¹è¯' }}\n                </p>\n                <div class=\"flex flex-wrap justify-center gap-3 max-w-2xl mx-auto\">\n                  <button v-for=\"(quickMsg, index) in quickMessages\" :key=\"quickMsg\" @click=\"sendQuickMessage(quickMsg)\"\n                    class=\"px-6 py-3 bg-cyan-500/20 border border-cyan-400/30 text-cyan-300 rounded-xl text-sm font-medium hover:bg-cyan-500/30 hover:border-cyan-400/50 transition-all duration-300 hover:scale-105 active:scale-95 animate-fade-in-up shadow-lg hover:shadow-cyan-400/20\"\n                    :style=\"{ animationDelay: `${index * 100}ms` }\">\n                    {{ quickMsg }}\n                  </button>\n                </div>\n              </div>\n\n              <!-- ç³»ç»Ÿæç¤º -->\n              <div v-if=\"!serviceStatus.adminOnline && messages.length > 0\" class=\"mb-6 animate-fade-in-up\">\n                <div\n                  class=\"bg-yellow-500/10 border border-yellow-400/30 rounded-lg p-4 text-center transition-all duration-300 hover:bg-yellow-500/15 hover:border-yellow-400/50\">\n                  <i class=\"bi bi-info-circle text-yellow-400 mr-2 animate-pulse\"></i>\n                  <span class=\"text-yellow-300 text-sm\">å½“å‰æš‚æ— å®¢æœåœ¨çº¿ï¼Œæ‚¨å¯ä»¥ç•™è¨€ï¼Œæˆ‘ä»¬ä¼šå°½å¿«å›å¤æ‚¨ã€‚</span>\n                </div>\n              </div>\n\n              <!-- èŠå¤©æ¶ˆæ¯åˆ—è¡¨ -->\n              <div class=\"space-y-4\">\n                <TransitionGroup name=\"message\" tag=\"div\" class=\"space-y-4\">\n                  <div v-for=\"message in messages\" :key=\"message.id || message.timestamp\" class=\"flex\"\n                    :class=\"isCurrentUserMessage(message) ? 'justify-end' : 'justify-start'\">\n\n                    <!-- å…¶ä»–äººçš„æ¶ˆæ¯ (å·¦è¾¹) - åŒ…æ‹¬å®¢æœ -->\n                    <div v-if=\"!isCurrentUserMessage(message)\" class=\"flex items-start gap-3 max-w-[70%]\">\n                      <!-- å‘é€è€…å¤´åƒ -->\n                      <div\n                        class=\"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 overflow-hidden border border-gray-600/30\">\n                        <img v-if=\"getMessageAvatar(message)\" :src=\"getMessageAvatar(message)\"\n                          :alt=\"getMessageNickname(message)\" class=\"w-full h-full object-cover\"\n                          @error=\"handleAvatarError\" @load=\"handleAvatarLoad\" />\n                        <div v-else class=\"w-full h-full rounded-full flex items-center justify-center\"\n                          :class=\"isCustomerServiceMessage(message) ? 'bg-gradient-to-r from-green-500 to-emerald-500' : 'bg-gradient-to-r from-gray-500 to-gray-600'\">\n                          <i class=\"text-white text-sm\"\n                            :class=\"isCustomerServiceMessage(message) ? 'bi bi-person-badge' : 'bi bi-person'\"></i>\n                        </div>\n                      </div>\n                      <div>\n                        <div class=\"bg-gray-700/50 border border-gray-600/30 rounded-2xl rounded-tl-sm p-3 text-white\">\n                          {{ message.message || message.data?.message }}\n                        </div>\n                        <div class=\"flex items-center gap-2 mt-1 ml-1\">\n                          <span class=\"text-xs\"\n                            :class=\"isCustomerServiceMessage(message) ? 'text-green-400' : 'text-gray-400'\">\n                            {{ message.nickname || message.data?.nickname || (isCustomerServiceMessage(message) ? 'å®¢æœ' :\n                            'ç”¨æˆ·') }}\n                          </span>\n                          <span class=\"text-xs text-gray-500\">{{ formatTime(message.timestamp || message.created_at)\n                            }}</span>\n                        </div>\n                      </div>\n                    </div>\n\n                    <!-- å½“å‰ç”¨æˆ·æ¶ˆæ¯ (å³è¾¹) -->\n                    <div v-else class=\"flex items-start gap-3 max-w-[70%] flex-row-reverse\">\n                      <!-- ç”¨æˆ·å¤´åƒ -->\n                      <div\n                        class=\"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 overflow-hidden border border-cyan-500/30\">\n                        <img v-if=\"getUserAvatar(message)\" :src=\"getUserAvatar(message)\" :alt=\"getUserNickname(message)\"\n                          class=\"w-full h-full object-cover\" @error=\"handleAvatarError\" @load=\"handleAvatarLoad\" />\n                        <div v-else\n                          class=\"w-full h-full bg-gradient-to-r from-cyan-600 to-blue-600 rounded-full flex items-center justify-center\">\n                          <i class=\"bi bi-person text-white text-sm\"></i>\n                        </div>\n                      </div>\n                      <div class=\"text-right\">\n                        <div\n                          class=\"bg-gradient-to-r from-cyan-600 to-blue-600 rounded-2xl rounded-tr-sm p-3 text-white\">\n                          {{ message.message || message.data?.message }}\n                        </div>\n                        <div class=\"flex items-center gap-2 mt-1 justify-end mr-1\">\n                          <span class=\"text-xs text-gray-500\">{{ formatTime(message.timestamp || message.created_at)\n                            }}</span>\n                          <span class=\"text-xs text-cyan-400\">\n                            {{ getUserNickname(message) }}\n                          </span>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n\n                </TransitionGroup>\n\n                <!-- æ­£åœ¨è¾“å…¥æç¤º -->\n                <div v-if=\"isTyping && typingUsers.size > 0\" class=\"flex justify-start mt-4\">\n                  <div v-for=\"[userId, userInfo] in typingUsers\" :key=\"userId\" class=\"flex items-start gap-3 max-w-[70%] animate-fade-in-up mb-2\">\n                    <!-- ç”¨æˆ·å¤´åƒ -->\n                    <div class=\"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 overflow-hidden border border-gray-600/30\">\n                      <img \n                        v-if=\"userInfo.avatar\" \n                        :src=\"userInfo.avatar\" \n                        :alt=\"userInfo.nickname\"\n                        class=\"w-full h-full object-cover\"\n                        @error=\"$event.target.style.display = 'none'\"\n                      />\n                      <div \n                        v-else\n                        class=\"w-full h-full bg-gradient-to-r from-green-500 to-emerald-500 rounded-full flex items-center justify-center animate-pulse-gentle\">\n                        <i class=\"bi bi-person-badge text-white text-sm\"></i>\n                      </div>\n                    </div>\n                    \n                    <div>\n                      <div class=\"bg-gray-700/50 border border-gray-600/30 rounded-2xl rounded-tl-sm p-3\">\n                        <div class=\"flex gap-1\">\n                          <div class=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\"></div>\n                          <div class=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style=\"animation-delay: 0.1s\"></div>\n                          <div class=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style=\"animation-delay: 0.2s\"></div>\n                        </div>\n                      </div>\n                      <div class=\"flex items-center gap-2 mt-1 ml-1\">\n                        <span class=\"text-xs text-green-400\">{{ userInfo.nickname }}</span>\n                        <span class=\"text-xs text-gray-500\">æ­£åœ¨è¾“å…¥...</span>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            <!-- èŠå¤©è¾“å…¥åŒºåŸŸ -->\n            <div class=\"px-6 py-4 border-t border-gray-700/50 bg-gray-800/20\">\n              <!-- å·¥å…·æŒ‰é’®ç»„ -->\n              <div class=\"flex items-center justify-between mb-3\">\n                <div class=\"flex items-center gap-2\">\n                  <button\n                    class=\"p-2 text-gray-400 hover:text-white hover:bg-gray-700/50 rounded-lg transition-all duration-300 hover:scale-110 active:scale-95\"\n                    title=\"é™„ä»¶\">\n                    <i class=\"bi bi-paperclip text-lg\"></i>\n                  </button>\n                  <button\n                    class=\"p-2 text-gray-400 hover:text-white hover:bg-gray-700/50 rounded-lg transition-all duration-300 hover:scale-110 active:scale-95\"\n                    title=\"è¡¨æƒ…\">\n                    <i class=\"bi bi-emoji-smile text-lg\"></i>\n                  </button>\n                </div>\n                \n                <!-- è¾“å…¥æç¤ºå·¥å…·æ  -->\n                <div class=\"flex items-center gap-3\">\n                  <span class=\"text-xs text-gray-500 flex items-center gap-1\">\n                    <i class=\"bi bi-keyboard\"></i>\n                    Enter å‘é€ï¼ŒShift+Enter æ¢è¡Œ\n                  </span>\n                  <div v-if=\"newMessage.length > 0\" class=\"text-xs text-gray-500\">\n                    {{ newMessage.length }} å­—ç¬¦\n                  </div>\n                  <button v-if=\"unreadCount > 0\" @click=\"markAllMessagesAsRead\"\n                    class=\"text-xs text-cyan-400 hover:text-cyan-300 transition-all duration-300 hover:scale-105 active:scale-95 px-3 py-1 rounded-lg hover:bg-cyan-500/10 border border-cyan-500/20\">\n                    <i class=\"bi bi-check2-all mr-1\"></i>\n                    æ ‡è®°å·²è¯» ({{ unreadCount }})\n                  </button>\n                </div>\n              </div>\n\n              <!-- è¾“å…¥æ¡†å’Œå‘é€æŒ‰é’® -->\n              <div class=\"flex items-end gap-3\">\n                <!-- è¾“å…¥æ¡†åŒºåŸŸ -->\n                <div class=\"flex-1 relative\">\n                  <textarea v-model=\"newMessage\" @keydown.enter.exact.prevent=\"sendMessage\"\n                    @input=\"adjustTextareaHeight\" @focus=\"handleInputFocus\" @blur=\"handleInputBlur\"\n                    :disabled=\"!isConnected\" placeholder=\"è¾“å…¥æ‚¨çš„æ¶ˆæ¯... (Enter å‘é€ï¼ŒShift+Enter æ¢è¡Œ)\" rows=\"1\"\n                    class=\"w-full px-4 py-3 bg-gray-800/50 border border-gray-600/50 rounded-xl focus:ring-2 focus:ring-cyan-500 focus:border-cyan-400 text-white placeholder-gray-400 transition-all duration-300 resize-none hover:border-cyan-500/50 focus:scale-[1.01] min-h-[48px] max-h-32 hide-scrollbar\"></textarea>\n                  <!-- è¾“å…¥çŠ¶æ€æŒ‡ç¤º -->\n                  <div v-if=\"isInputFocused\"\n                    class=\"absolute -top-6 left-2 text-xs text-cyan-400 bg-gray-800/80 px-2 py-1 rounded-lg\">\n                    æ­£åœ¨è¾“å…¥...\n                  </div>\n                </div>\n\n                <!-- å‘é€æŒ‰é’® -->\n                <button @click=\"sendMessage\" :disabled=\"!newMessage.trim() || !isConnected\"\n                  class=\"px-6 py-3 bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 disabled:from-gray-600 disabled:to-gray-700 text-white font-semibold rounded-xl transition-all duration-300 shadow-lg shadow-cyan-500/20 hover:shadow-cyan-500/40 disabled:shadow-none flex items-center gap-2 hover:scale-105 active:scale-95 min-h-[48px] flex-shrink-0\">\n                  <i class=\"bi bi-send text-lg\"></i>\n                  <span class=\"hidden sm:inline\">å‘é€</span>\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n\n    </main>\n  </div>\n</template>\n\n<script setup>\nimport { ref, computed, onMounted, onUnmounted, nextTick, watch } from 'vue'\nimport { useUserStore } from '~/stores/user'\nimport { ChatApi } from '~/utils/api/chat'\n\n// çŠ¶æ€ç®¡ç†\nconst userStore = useUserStore()\nconst isConnected = ref(false)\nconst isTyping = ref(false)\nconst typingUsers = ref(new Map()) // å­˜å‚¨æ­£åœ¨è¾“å…¥çš„ç”¨æˆ·ï¼Œæ ¼å¼ï¼šuserId -> { nickname, avatar, timestamp }\nconst unreadCount = ref(0)\nconst newMessage = ref('')\nconst messages = ref([])\nconst sessions = ref([])\nconst messagesContainer = ref()\nconst selectedSession = ref(null) // å½“å‰é€‰ä¸­çš„ä¼šè¯\n\n// æœåŠ¡çŠ¶æ€\nconst serviceStatus = ref({\n  adminOnline: false,\n  adminCount: 0,\n  totalUsers: 0,\n  normalUserCount: 0\n})\n\n// WebSocketè¿æ¥\nlet websocket = null\nlet heartbeatTimer = null\n\n// å¿«é€Ÿæ¶ˆæ¯\nconst quickMessages = [\n  'ä½ å¥½ï¼Œè¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©æ‚¨çš„ï¼Ÿ',\n  'æˆ‘æƒ³äº†è§£äº§å“ä¿¡æ¯',\n  'è®¢å•ç›¸å…³é—®é¢˜',\n  'æŠ€æœ¯æ”¯æŒ'\n]\n\n// è®¡ç®—å±æ€§\nconst isLoggedIn = computed(() => userStore.isLoggedIn)\n\n// å½“å‰èŠå¤©å¯¹è±¡ä¿¡æ¯\nconst currentChatUser = computed(() => {\n  if (!selectedSession.value) {\n    return {\n      name: 'xlCig å®¢æœå›¢é˜Ÿ',\n      avatar: null,\n      status: serviceStatus.value.adminOnline ? 'åœ¨çº¿ - å¹³å‡å“åº”æ—¶é—´ < 1åˆ†é’Ÿ' : 'ç¦»çº¿ - æˆ‘ä»¬ä¼šå°½å¿«å›å¤æ‚¨çš„æ¶ˆæ¯',\n      isCustomerService: true\n    }\n  }\n\n  return {\n    name: selectedSession.value.displayName || selectedSession.value.user_nickname || selectedSession.value.user_name || `ç”¨æˆ· #${selectedSession.value.user_id}`,\n    avatar: selectedSession.value.avatar || selectedSession.value.user_avatar,\n    status: selectedSession.value.isOnline ? 'åœ¨çº¿ - ç”¨æˆ·å¯¹è¯' : 'ç¦»çº¿ - ç”¨æˆ·å¯¹è¯',\n    isCustomerService: false,\n    isOnline: selectedSession.value.isOnline,\n    userId: selectedSession.value.user_id,\n    sessionId: selectedSession.value.id\n  }\n})\n\n// é¡µé¢å…ƒæ•°æ®\nuseHead({\n  title: 'åœ¨çº¿å®¢æœ - xlCig',\n  meta: [\n    { name: 'description', content: 'ä¸“ä¸šçš„åœ¨çº¿å®¢æœæœåŠ¡ï¼Œä¸ºæ‚¨æä¾›å®æ—¶å¸®åŠ©å’Œæ”¯æŒ' }\n  ]\n})\n\n// WebSocketè¿æ¥\nconst connectWebSocket = () => {\n  if (!isLoggedIn.value || !userStore.token) {\n    console.error('ç”¨æˆ·æœªç™»å½•ï¼Œæ— æ³•è¿æ¥WebSocket')\n    return\n  }\n\n  try {\n    const wsUrl = `ws://192.168.11.194:9999/websocket?token=${userStore.token}`\n    console.log('æ­£åœ¨è¿æ¥WebSocket:', wsUrl)\n\n    websocket = new WebSocket(wsUrl)\n\n    websocket.onopen = () => {\n      console.log('WebSocketè¿æ¥æˆåŠŸ')\n      isConnected.value = true\n      startHeartbeat()\n      \n      // è¿æ¥æˆåŠŸåï¼Œè¯·æ±‚è·å–å½“å‰æ‰€æœ‰ç”¨æˆ·çš„åœ¨çº¿çŠ¶æ€\n      setTimeout(() => {\n        if (websocket && websocket.readyState === WebSocket.OPEN) {\n          websocket.send(JSON.stringify({ \n            type: 'get_users_status',\n            data: {}\n          }))\n          console.log('å·²è¯·æ±‚è·å–ç”¨æˆ·åœ¨çº¿çŠ¶æ€')\n        }\n      }, 1000)\n    }\n\n    websocket.onmessage = (event) => {\n      try {\n        const message = JSON.parse(event.data)\n        handleWebSocketMessage(message)\n      } catch (error) {\n        console.error('è§£æWebSocketæ¶ˆæ¯å¤±è´¥:', error)\n      }\n    }\n\n    websocket.onclose = () => {\n      console.log('WebSocketè¿æ¥å…³é—­')\n      isConnected.value = false\n      stopHeartbeat()\n\n      // è‡ªåŠ¨é‡è¿\n      setTimeout(() => {\n        console.log('å°è¯•é‡æ–°è¿æ¥WebSocket...')\n        connectWebSocket()\n      }, 3000)\n    }\n\n    websocket.onerror = (error) => {\n      console.error('WebSocketè¿æ¥é”™è¯¯:', error)\n      isConnected.value = false\n    }\n\n  } catch (error) {\n    console.error('åˆ›å»ºWebSocketè¿æ¥å¤±è´¥:', error)\n  }\n}\n\nconst disconnectWebSocket = () => {\n  if (websocket) {\n    websocket.close()\n    websocket = null\n  }\n  stopHeartbeat()\n  isConnected.value = false\n}\n\n// å¿ƒè·³æœºåˆ¶\nconst startHeartbeat = () => {\n  heartbeatTimer = setInterval(() => {\n    if (websocket && websocket.readyState === WebSocket.OPEN) {\n      websocket.send(JSON.stringify({ type: 'ping' }))\n    }\n  }, 30000)\n}\n\nconst stopHeartbeat = () => {\n  if (heartbeatTimer) {\n    clearInterval(heartbeatTimer)\n    heartbeatTimer = null\n  }\n}\n\n// å¤„ç†WebSocketæ¶ˆæ¯\nconst handleWebSocketMessage = (message) => {\n  console.log('æ”¶åˆ°WebSocketæ¶ˆæ¯:', message)\n\n  switch (message.type) {\n    case 'user_info':\n      console.log('ç”¨æˆ·ä¿¡æ¯:', message.data)\n      unreadCount.value = message.data.unreadCount || 0\n      if (message.data.stats) {\n        serviceStatus.value = message.data.stats\n      }\n      break\n\n    case 'message':\n      // ç¡®ä¿åŒ…å«å¤´åƒå’Œæ˜µç§°ä¿¡æ¯ï¼Œå¹¶æ­£ç¡®è¯†åˆ«æ¶ˆæ¯ç±»å‹\n      const isCustomerServiceMsg = message.isAdmin || message.data?.isAdmin || message.data?.isCustomerService || message.data?.role === 'admin' || message.data?.role === 'customer_service'\n\n      const messageWithUserInfo = {\n        ...message,\n        user_id: message.user_id || message.data?.user_id || message.data?.userId,\n        avatar: message.avatar || message.data?.avatar,\n        nickname: message.nickname || message.data?.nickname || message.data?.userName,\n        userName: message.userName || message.data?.userName,\n        // æ£€æŸ¥æ˜¯å¦ä¸ºå®¢æœæ¶ˆæ¯\n        isAdmin: isCustomerServiceMsg,\n        message_type: message.message_type || (isCustomerServiceMsg ? 'customer_service' : 'user'),\n        // å¯¹äºå®¢æœæ¶ˆæ¯ï¼Œæ·»åŠ å‘é€è€…IDä¿¡æ¯\n        ...(isCustomerServiceMsg && {\n          senderId: message.data?.userId || message.userId || message.data?.senderId,\n          data: {\n            ...message.data,\n            userId: message.data?.userId || message.userId,\n            senderId: message.data?.senderId || message.data?.userId\n          }\n        })\n      }\n\n      console.log('å¤„ç†åçš„æ¶ˆæ¯:', messageWithUserInfo)\n\n      // å¦‚æœé€‰ä¸­äº†ç‰¹å®šç”¨æˆ·ï¼Œåªæ˜¾ç¤ºè¯¥ç”¨æˆ·ç›¸å…³çš„æ¶ˆæ¯\n      if (selectedSession.value) {\n        const messageUserId = messageWithUserInfo.user_id || messageWithUserInfo.data?.targetUserId\n        if (messageUserId === selectedSession.value.user_id) {\n          messages.value.push(messageWithUserInfo)\n          scrollToBottom()\n        } else {\n          console.log('æ¶ˆæ¯ä¸å±äºå½“å‰é€‰ä¸­ç”¨æˆ·ï¼Œä¸æ˜¾ç¤º:', messageUserId, 'å½“å‰ç”¨æˆ·:', selectedSession.value.user_id)\n        }\n      } else {\n        // æœªé€‰ä¸­ç‰¹å®šç”¨æˆ·ï¼Œæ˜¾ç¤ºæ‰€æœ‰æ¶ˆæ¯ï¼ˆé»˜è®¤å®¢æœæ¨¡å¼ï¼‰\n        messages.value.push(messageWithUserInfo)\n        scrollToBottom()\n      }\n\n      // å½“æ”¶åˆ°æ–°æ¶ˆæ¯æ—¶è‡ªåŠ¨æ ‡è®°ä¸ºå·²è¯»\n      nextTick(() => {\n        autoMarkAsRead()\n      })\n\n      // æ›´æ–°ä¼šè¯åˆ—è¡¨ä¸­çš„æœªè¯»æ•°é‡å’Œæœ€åæ¶ˆæ¯\n      if (messageWithUserInfo.user_id) {\n        updateSessionList(messageWithUserInfo)\n      }\n      break\n\n    case 'typing':\n      console.log('æ”¶åˆ°è¾“å…¥çŠ¶æ€æ¶ˆæ¯:', message.data)\n      handleTypingMessage(message.data, true)\n      break\n\n    case 'stop_typing':\n      console.log('æ”¶åˆ°åœæ­¢è¾“å…¥æ¶ˆæ¯:', message.data)\n      handleTypingMessage(message.data, false)\n      break\n\n    case 'message_read':\n      unreadCount.value = message.data.unreadCount || 0\n      break\n\n    case 'user_online':\n      console.log('ç”¨æˆ·ä¸Šçº¿:', message.data)\n      updateUserOnlineStatus(message.data.userId || message.data.user_id, true, message.data)\n      break\n\n    case 'user_offline':\n      console.log('ç”¨æˆ·ä¸‹çº¿:', message.data)\n      updateUserOnlineStatus(message.data.userId || message.data.user_id, false, message.data)\n      break\n\n    case 'user_status_update':\n      console.log('ç”¨æˆ·çŠ¶æ€æ›´æ–°:', message.data)\n      if (message.data && (message.data.userId || message.data.user_id)) {\n        const isOnline = message.data.isOnline !== undefined ? message.data.isOnline : true\n        updateUserOnlineStatus(message.data.userId || message.data.user_id, isOnline, message.data)\n      }\n      break\n\n    case 'users_status_response':\n      console.log('æ”¶åˆ°ç”¨æˆ·çŠ¶æ€åˆ—è¡¨:', message.data)\n      if (message.data && Array.isArray(message.data.users)) {\n        message.data.users.forEach(user => {\n          updateUserOnlineStatus(user.userId || user.user_id, user.isOnline, user)\n        })\n      }\n      break\n\n    case 'error':\n      console.error('WebSocketé”™è¯¯:', message.data)\n      break\n  }\n}\n\n// æ¸…é™¤æ‰€æœ‰typingçŠ¶æ€\nconst clearTypingStates = () => {\n  typingUsers.value.clear()\n  isTyping.value = false\n  console.log('å·²æ¸…é™¤æ‰€æœ‰typingçŠ¶æ€')\n}\n\n// å¤„ç†è¾“å…¥çŠ¶æ€æ¶ˆæ¯\nconst handleTypingMessage = (data, isTyping) => {\n  const userId = data.userId || data.user_id || data.senderId\n  const targetUserId = data.targetUserId || data.target_user_id\n  \n  console.log('å¤„ç†è¾“å…¥çŠ¶æ€:', { userId, targetUserId, isTyping, currentSession: selectedSession.value?.user_id })\n  \n  // å¦‚æœæ˜¯åœ¨ç‰¹å®šç”¨æˆ·å¯¹è¯æ¨¡å¼ä¸‹\n  if (selectedSession.value) {\n    // åªæœ‰å½“å‰é€‰ä¸­ç”¨æˆ·æˆ–è€…ç›®æ ‡ç”¨æˆ·æ˜¯å½“å‰é€‰ä¸­ç”¨æˆ·æ—¶ï¼Œæ‰æ˜¾ç¤ºtypingçŠ¶æ€\n    const isCurrentSessionUser = userId === selectedSession.value.user_id || targetUserId === selectedSession.value.user_id\n    \n    if (isCurrentSessionUser) {\n      if (isTyping) {\n        // æ·»åŠ /æ›´æ–°æ­£åœ¨è¾“å…¥çš„ç”¨æˆ·\n        typingUsers.value.set(userId, {\n          nickname: data.nickname || data.userName || 'ç”¨æˆ·',\n          avatar: data.avatar,\n          timestamp: Date.now()\n        })\n        isTyping.value = true\n        console.log(`ç”¨æˆ· ${userId} å¼€å§‹è¾“å…¥`)\n      } else {\n        // ç§»é™¤æ­£åœ¨è¾“å…¥çš„ç”¨æˆ·\n        typingUsers.value.delete(userId)\n        isTyping.value = typingUsers.value.size > 0\n        console.log(`ç”¨æˆ· ${userId} åœæ­¢è¾“å…¥`)\n      }\n    }\n  } else {\n    // å®¢æœå›¢é˜Ÿæ¨¡å¼ä¸‹ï¼Œæ˜¾ç¤ºæ‰€æœ‰è¾“å…¥çŠ¶æ€\n    if (isTyping) {\n      typingUsers.value.set(userId, {\n        nickname: data.nickname || data.userName || 'ç”¨æˆ·',\n        avatar: data.avatar,\n        timestamp: Date.now()\n      })\n      isTyping.value = true\n      console.log(`ç”¨æˆ· ${userId} å¼€å§‹è¾“å…¥ï¼ˆå›¢é˜Ÿæ¨¡å¼ï¼‰`)\n    } else {\n      typingUsers.value.delete(userId)\n      isTyping.value = typingUsers.value.size > 0\n      console.log(`ç”¨æˆ· ${userId} åœæ­¢è¾“å…¥ï¼ˆå›¢é˜Ÿæ¨¡å¼ï¼‰`)\n    }\n  }\n}\n\n// æ›´æ–°ç”¨æˆ·åœ¨çº¿çŠ¶æ€\nconst updateUserOnlineStatus = (userId, isOnline, userData = {}) => {\n  if (!userId) return\n  \n  console.log(`æ›´æ–°ç”¨æˆ· ${userId} åœ¨çº¿çŠ¶æ€:`, isOnline, userData)\n  \n  // æ›´æ–°ä¼šè¯åˆ—è¡¨ä¸­çš„ç”¨æˆ·çŠ¶æ€\n  const sessionIndex = sessions.value.findIndex(session => session.user_id === userId)\n  if (sessionIndex >= 0) {\n    const session = sessions.value[sessionIndex]\n    const previousStatus = session.isOnline\n    \n    // æ›´æ–°åœ¨çº¿çŠ¶æ€\n    session.isOnline = isOnline\n    \n    // å¦‚æœæœ‰æ–°çš„ç”¨æˆ·æ•°æ®ï¼Œæ›´æ–°ç›¸å…³ä¿¡æ¯\n    if (userData.userName && userData.userName !== session.user_name) {\n      session.user_name = userData.userName\n      session.displayName = userData.userName\n    }\n    if (userData.nickname && userData.nickname !== session.user_nickname) {\n      session.user_nickname = userData.nickname\n      session.displayName = userData.nickname\n    }\n    if (userData.avatar && userData.avatar !== session.avatar) {\n      session.avatar = userData.avatar\n      session.user_avatar = userData.avatar\n    }\n    \n    // çŠ¶æ€å˜åŒ–æç¤º\n    if (previousStatus !== isOnline) {\n      const userName = session.displayName || session.user_nickname || session.user_name || `ç”¨æˆ· #${userId}`\n      console.log(`ğŸ“± ${userName} ${isOnline ? 'ğŸŸ¢ ä¸Šçº¿äº†' : 'ğŸ”´ ä¸‹çº¿äº†'}`)\n      \n      // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ Toastæç¤ºæˆ–å…¶ä»–è§†è§‰åé¦ˆ\n      // ä¾‹å¦‚ï¼šshowToast(`${userName} ${isOnline ? 'ä¸Šçº¿äº†' : 'ä¸‹çº¿äº†'}`)\n    }\n    \n    console.log(`ä¼šè¯åˆ—è¡¨ä¸­ç”¨æˆ· ${userId} çŠ¶æ€å·²æ›´æ–°:`, session)\n  } else {\n    // å¦‚æœä¼šè¯åˆ—è¡¨ä¸­æ²¡æœ‰è¿™ä¸ªç”¨æˆ·ï¼Œä¸”ç”¨æˆ·ä¸Šçº¿äº†ï¼Œå¯ä»¥è€ƒè™‘é‡æ–°åŠ è½½ä¼šè¯åˆ—è¡¨\n    if (isOnline) {\n      console.log(`æ–°ç”¨æˆ· ${userId} ä¸Šçº¿ï¼Œé‡æ–°åŠ è½½ä¼šè¯åˆ—è¡¨`)\n      loadChatSessions()\n    }\n  }\n  \n  // å¦‚æœå½“å‰é€‰ä¸­çš„ç”¨æˆ·çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œè§¦å‘è®¡ç®—å±æ€§æ›´æ–°\n  if (selectedSession.value && selectedSession.value.user_id === userId) {\n    selectedSession.value.isOnline = isOnline\n    \n    // æ›´æ–°é€‰ä¸­ç”¨æˆ·çš„å…¶ä»–ä¿¡æ¯\n    if (userData.userName) selectedSession.value.user_name = userData.userName\n    if (userData.nickname) selectedSession.value.user_nickname = userData.nickname\n    if (userData.avatar) {\n      selectedSession.value.avatar = userData.avatar\n      selectedSession.value.user_avatar = userData.avatar\n    }\n    \n    console.log(`å½“å‰é€‰ä¸­ç”¨æˆ· ${userId} çŠ¶æ€å·²æ›´æ–°`, selectedSession.value)\n  }\n}\n\n// è‡ªåŠ¨è°ƒæ•´textareaé«˜åº¦\nconst adjustTextareaHeight = (event) => {\n  const textarea = event.target\n  textarea.style.height = 'auto'\n  textarea.style.height = Math.min(textarea.scrollHeight, 128) + 'px' // æœ€å¤§é«˜åº¦128px\n}\n\n// å‘é€æ¶ˆæ¯\nconst sendMessage = async () => {\n  if (!newMessage.value.trim()) {\n    return\n  }\n\n  const messageText = newMessage.value.trim()\n\n  try {\n    if (selectedSession.value) {\n      // é€‰ä¸­äº†ç‰¹å®šç”¨æˆ·ï¼Œä½¿ç”¨APIå‘é€æ¶ˆæ¯\n      console.log('å‘ç”¨æˆ·å‘é€æ¶ˆæ¯:', selectedSession.value.user_id, messageText)\n      const response = await ChatApi.sendMessage(messageText, selectedSession.value.user_id)\n\n      if (response.success) {\n        // æ·»åŠ æ¶ˆæ¯åˆ°æœ¬åœ°æ˜¾ç¤ºï¼ˆå®¢æœå‘é€çš„æ¶ˆæ¯ï¼‰\n        const adminMessage = {\n          id: Date.now(),\n          user_id: selectedSession.value.user_id, // æ¶ˆæ¯å½’å±äºç›®æ ‡ç”¨æˆ·ï¼ˆæ•°æ®åº“å­˜å‚¨ï¼‰\n          senderId: userStore.user?.id, // å‘é€è€…IDï¼ˆç”¨äºUIåˆ¤æ–­ï¼‰\n          message: messageText,\n          message_type: 'customer_service',\n          isAdmin: true,\n          avatar: userStore.user?.avatar,\n          nickname: userStore.userDisplayName,\n          userName: userStore.userDisplayName,\n          timestamp: Date.now(),\n          created_at: new Date().toISOString(),\n          data: {\n            userId: userStore.user?.id, // ç¡®ä¿dataä¸­ä¹Ÿæœ‰å‘é€è€…ID\n            userName: userStore.userDisplayName,\n            isAdmin: true\n          }\n        }\n\n        messages.value.push(adminMessage)\n        console.log('æ¶ˆæ¯å‘é€æˆåŠŸï¼Œå·²æ·»åŠ åˆ°æœ¬åœ°æ˜¾ç¤º')\n      }\n    } else {\n      // é»˜è®¤å®¢æœæ¨¡å¼ï¼Œé€šè¿‡WebSocketå‘é€\n      if (!isConnected.value || !websocket) {\n        console.error('WebSocketæœªè¿æ¥')\n        return\n      }\n\n      const message = {\n        type: 'message',\n        data: {\n          message: messageText,\n          user_id: userStore.user?.id,\n          userId: userStore.user?.id\n        }\n      }\n\n      websocket.send(JSON.stringify(message))\n\n      // æ·»åŠ åˆ°æœ¬åœ°æ¶ˆæ¯åˆ—è¡¨\n      const userAvatar = userStore.user?.avatar\n      messages.value.push({\n        ...message,\n        data: {\n          ...message.data,\n          userId: userStore.user?.id,\n          userName: userStore.userDisplayName,\n          isAdmin: false,\n          avatar: userAvatar\n        },\n        user_id: userStore.user?.id,\n        timestamp: Date.now(),\n        isAdmin: false,\n        message_type: 'user',\n        avatar: userAvatar,\n        nickname: userStore.user?.nickname || userStore.userDisplayName,\n        userName: userStore.userDisplayName\n      })\n    }\n\n    newMessage.value = ''\n\n    // é‡ç½®textareaé«˜åº¦\n    nextTick(() => {\n      const textarea = document.querySelector('textarea')\n      if (textarea) {\n        textarea.style.height = '48px'\n      }\n    })\n\n    scrollToBottom()\n\n    // å‘é€æ¶ˆæ¯ååœæ­¢è¾“å…¥çŠ¶æ€\n    sendStopTyping()\n\n  } catch (error) {\n    console.error('å‘é€æ¶ˆæ¯å¤±è´¥:', error)\n  }\n}\n\n// å‘é€å¿«é€Ÿæ¶ˆæ¯\nconst sendQuickMessage = (message) => {\n  newMessage.value = message\n  sendMessage()\n}\n\n// è¾“å…¥æ¡†ç„¦ç‚¹çŠ¶æ€ç®¡ç†\nconst isInputFocused = ref(false)\n\n// å¤„ç†è¾“å…¥æ¡†è·å¾—ç„¦ç‚¹\nconst handleInputFocus = () => {\n  console.log('è¾“å…¥æ¡†è·å¾—ç„¦ç‚¹')\n  isInputFocused.value = true\n\n  // å‘é€æ­£åœ¨è¾“å…¥çŠ¶æ€ï¼ˆèŠ‚æµå‘é€ï¼‰\n  if (!isConnected.value || !websocket) return\n\n  try {\n    websocket.send(JSON.stringify({\n      type: 'typing',\n      data: {\n        userId: userStore.user?.id,\n        userName: userStore.userDisplayName,\n        nickname: userStore.user?.nickname || userStore.userDisplayName,\n        avatar: userStore.user?.avatar,\n        targetUserId: selectedSession.value?.user_id,\n        chatMode: selectedSession.value ? 'user_conversation' : 'customer_service',\n        isAdmin: userStore.user?.role === 'admin',\n        isCustomerService: userStore.user?.role === 'admin' || userStore.user?.role === 'customer_service'\n      }\n    }))\n  } catch (error) {\n    console.error('å‘é€è¾“å…¥çŠ¶æ€å¤±è´¥:', error)\n  }\n}\n\n// å¤„ç†è¾“å…¥æ¡†å¤±å»ç„¦ç‚¹\nconst handleInputBlur = () => {\n  console.log('è¾“å…¥æ¡†å¤±å»ç„¦ç‚¹')\n  isInputFocused.value = false\n\n  // å»¶è¿Ÿå‘é€åœæ­¢è¾“å…¥çŠ¶æ€ï¼Œé¿å…å¿«é€Ÿç„¦ç‚¹åˆ‡æ¢å¯¼è‡´çš„é—ªçƒ\n  setTimeout(() => {\n    if (!isInputFocused.value) {\n      sendStopTyping()\n    }\n  }, 500)\n}\n\nconst sendStopTyping = () => {\n  if (!isConnected.value || !websocket) return\n\n  try {\n    websocket.send(JSON.stringify({\n      type: 'stop_typing',\n      data: {\n        userId: userStore.user?.id,\n        userName: userStore.userDisplayName,\n        nickname: userStore.user?.nickname || userStore.userDisplayName,\n        avatar: userStore.user?.avatar,\n        targetUserId: selectedSession.value?.user_id,\n        chatMode: selectedSession.value ? 'user_conversation' : 'customer_service',\n        isAdmin: userStore.user?.role === 'admin',\n        isCustomerService: userStore.user?.role === 'admin' || userStore.user?.role === 'customer_service'\n      }\n    }))\n  } catch (error) {\n    console.error('å‘é€åœæ­¢è¾“å…¥çŠ¶æ€å¤±è´¥:', error)\n  }\n}\n\n// åŠ è½½æ•°æ®\nconst loadChatHistory = async () => {\n  try {\n    const response = await ChatApi.getChatHistory({ limit: 50 })\n    if (response.success && response.data) {\n      messages.value = response.data.map(msg => {\n        console.log('å†å²æ¶ˆæ¯:', msg)\n\n        // åˆ¤æ–­æ˜¯å¦ä¸ºå®¢æœæ¶ˆæ¯çš„é€»è¾‘\n        const isCustomerService = msg.message_type === 'customer_service' ||\n          msg.role === 'admin' ||\n          msg.role === 'customer_service'\n\n        const processedMsg = {\n          ...msg,\n          user_id: msg.user_id || msg.id, // ç¡®ä¿æœ‰user_id\n          isAdmin: isCustomerService,\n          avatar: msg.avatar || msg.user_avatar, // ä¼˜å…ˆä½¿ç”¨æ¶ˆæ¯å¤´åƒï¼Œå†ä½¿ç”¨ç”¨æˆ·å¤´åƒ\n          nickname: msg.nickname || msg.user_nickname || msg.username,\n          userName: msg.nickname || msg.user_nickname || msg.username,\n          message_type: isCustomerService ? 'customer_service' : 'user'\n        }\n\n        console.log('å¤„ç†åçš„å†å²æ¶ˆæ¯:', processedMsg, {\n          isCustomerService,\n          userId: msg.user_id,\n          currentUserId: userStore.user?.id,\n          isCurrentUser: msg.user_id === userStore.user?.id\n        })\n\n        return processedMsg\n      })\n      console.log('æ‰€æœ‰å¤„ç†åçš„å†å²æ¶ˆæ¯:', messages.value)\n      scrollToBottom()\n    }\n  } catch (error) {\n    console.error('åŠ è½½èŠå¤©å†å²å¤±è´¥:', error)\n  }\n}\n\nconst loadChatSessions = async () => {\n  try {\n    const response = await ChatApi.getUserSessions({ limit: 20 })\n    if (response.success && response.data) {\n      sessions.value = response.data.map(session => {\n        console.log('åŸå§‹ç”¨æˆ·ä¼šè¯æ•°æ®:', session)\n        const processedSession = {\n          ...session,\n          id: session.user_id, // ä½¿ç”¨user_idä½œä¸ºä¼šè¯ID\n          user_avatar: session.avatar,\n          user_nickname: session.nickname,\n          user_name: session.nickname || session.username,\n          unread_count: session.unread_count || 0,\n          last_message: session.last_message,\n          last_message_time: session.last_message_time,\n          last_message_type: session.last_message_type,\n          isOnline: session.isOnline || false, // åœ¨çº¿çŠ¶æ€\n          displayName: session.displayName || session.nickname || session.username, // æ˜¾ç¤ºåç§°\n          status: 'active' // é»˜è®¤çŠ¶æ€\n        }\n        console.log('å¤„ç†åçš„ç”¨æˆ·ä¼šè¯æ•°æ®:', processedSession)\n        return processedSession\n      })\n    }\n  } catch (error) {\n    console.error('åŠ è½½ç”¨æˆ·ä¼šè¯åˆ—è¡¨å¤±è´¥:', error)\n  }\n}\n\nconst loadServiceStatus = async () => {\n  try {\n    const response = await ChatApi.getServiceStatus()\n    if (response.success) {\n      serviceStatus.value = response.data\n    }\n  } catch (error) {\n    console.error('è·å–æœåŠ¡çŠ¶æ€å¤±è´¥:', error)\n  }\n}\n\nconst loadUnreadCount = async () => {\n  try {\n    const response = await ChatApi.getUnreadCount()\n    if (response.success) {\n      unreadCount.value = response.data.unreadCount\n    }\n  } catch (error) {\n    console.error('è·å–æœªè¯»æ¶ˆæ¯æ•°é‡å¤±è´¥:', error)\n  }\n}\n\n// æ ‡è®°æ‰€æœ‰æ¶ˆæ¯ä¸ºå·²è¯»\nconst markAllMessagesAsRead = async () => {\n  try {\n    const response = await ChatApi.markMessagesAsRead()\n    if (response.success) {\n      unreadCount.value = response.data.unreadCount\n    }\n  } catch (error) {\n    console.error('æ ‡è®°æ¶ˆæ¯å·²è¯»å¤±è´¥:', error)\n  }\n}\n\n// å·¥å…·å‡½æ•°\nconst scrollToBottom = () => {\n  nextTick(() => {\n    if (messagesContainer.value) {\n      messagesContainer.value.scrollTop = messagesContainer.value.scrollHeight\n    }\n  })\n}\n\n// åˆ¤æ–­æ˜¯å¦ä¸ºå½“å‰ç”¨æˆ·çš„æ¶ˆæ¯\nconst isCurrentUserMessage = (message) => {\n  const currentUserId = userStore.user?.id\n\n  // å¦‚æœæ˜¯å®¢æœæ¶ˆæ¯ç±»å‹ï¼Œæ£€æŸ¥æ˜¯å¦æ˜¯å½“å‰ç®¡ç†å‘˜å‘é€çš„\n  if (message.message_type === 'customer_service' || message.isAdmin) {\n    // æ£€æŸ¥å‘é€è€…ä¿¡æ¯ï¼Œä¼˜å…ˆä½¿ç”¨ senderId æˆ– data.userId\n    const senderId = message.senderId || message.data?.userId || message.data?.senderId\n    if (senderId) {\n      return senderId === currentUserId\n    }\n\n    // å¦‚æœæ²¡æœ‰æ˜ç¡®çš„å‘é€è€…IDï¼Œæ£€æŸ¥æ˜µç§°/ç”¨æˆ·åæ˜¯å¦åŒ¹é…\n    const senderName = message.nickname || message.userName || message.data?.userName\n    const currentUserName = userStore.userDisplayName\n    if (senderName && currentUserName) {\n      return senderName === currentUserName\n    }\n  }\n\n  // å¯¹äºæ™®é€šç”¨æˆ·æ¶ˆæ¯ï¼Œä½¿ç”¨ user_id åˆ¤æ–­\n  const messageUserId = message.user_id || message.data?.user_id || message.data?.userId\n  return messageUserId === currentUserId\n}\n\n// åˆ¤æ–­æ˜¯å¦ä¸ºå®¢æœæ¶ˆæ¯ï¼ˆä»…ç”¨äºæ˜¾ç¤ºå®¢æœæ ‡è¯†ï¼Œä¸å½±å“ä½ç½®ï¼‰\nconst isCustomerServiceMessage = (message) => {\n  // å¤šé‡æ£€æŸ¥ç¡®ä¿æ­£ç¡®è¯†åˆ«å®¢æœæ¶ˆæ¯\n  return message.isAdmin === true ||\n    message.message_type === 'customer_service' ||\n    message.data?.isAdmin === true ||\n    message.data?.isCustomerService === true ||\n    message.data?.role === 'admin' ||\n    message.data?.role === 'customer_service'\n}\n\nconst formatTime = (timestamp) => {\n  if (!timestamp) return ''\n\n  const date = new Date(timestamp)\n  const now = new Date()\n  const diffInMs = now - date\n  const diffInMinutes = Math.floor(diffInMs / (1000 * 60))\n  const diffInHours = Math.floor(diffInMs / (1000 * 60 * 60))\n  const diffInDays = Math.floor(diffInMs / (1000 * 60 * 60 * 24))\n\n  // å¦‚æœæ˜¯ä»Šå¤©\n  if (diffInDays === 0) {\n    if (diffInMinutes < 1) {\n      return 'åˆšåˆš'\n    } else if (diffInMinutes < 60) {\n      return `${diffInMinutes}åˆ†é’Ÿå‰`\n    } else {\n      return date.toLocaleTimeString('zh-CN', {\n        hour12: false,\n        hour: '2-digit',\n        minute: '2-digit'\n      })\n    }\n  }\n  // å¦‚æœæ˜¯æ˜¨å¤©\n  else if (diffInDays === 1) {\n    return `æ˜¨å¤© ${date.toLocaleTimeString('zh-CN', {\n      hour12: false,\n      hour: '2-digit',\n      minute: '2-digit'\n    })}`\n  }\n  // å¦‚æœæ˜¯æ›´æ—©\n  else if (diffInDays < 7) {\n    const weekdays = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­']\n    return `${weekdays[date.getDay()]} ${date.toLocaleTimeString('zh-CN', {\n      hour12: false,\n      hour: '2-digit',\n      minute: '2-digit'\n    })}`\n  }\n  // è¶…è¿‡ä¸€å‘¨\n  else {\n    return date.toLocaleDateString('zh-CN', {\n      month: '2-digit',\n      day: '2-digit',\n      hour: '2-digit',\n      minute: '2-digit'\n    })\n  }\n}\n\nconst formatDate = (dateString) => {\n  if (!dateString) return ''\n\n  const date = new Date(dateString)\n  const now = new Date()\n  const diffInMs = now - date\n  const diffInDays = Math.floor(diffInMs / (1000 * 60 * 60 * 24))\n\n  if (diffInDays === 0) {\n    return date.toLocaleTimeString('zh-CN', {\n      hour12: false,\n      hour: '2-digit',\n      minute: '2-digit'\n    })\n  } else if (diffInDays === 1) {\n    return 'æ˜¨å¤©'\n  } else if (diffInDays < 7) {\n    const weekdays = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­']\n    return weekdays[date.getDay()]\n  } else {\n    return date.toLocaleDateString('zh-CN', {\n      month: '2-digit',\n      day: '2-digit'\n    })\n  }\n}\n\nconst getSessionStatusClass = (status) => {\n  switch (status) {\n    case 'active':\n      return 'bg-green-500/20 text-green-400 border-green-500/30'\n    case 'waiting':\n      return 'bg-yellow-500/20 text-yellow-400 border-yellow-500/30'\n    case 'closed':\n      return 'bg-gray-500/20 text-gray-400 border-gray-500/30'\n    default:\n      return 'bg-gray-500/20 text-gray-400 border-gray-500/30'\n  }\n}\n\nconst getSessionStatusText = (status) => {\n  switch (status) {\n    case 'active':\n      return 'è¿›è¡Œä¸­'\n    case 'waiting':\n      return 'ç­‰å¾…ä¸­'\n    case 'closed':\n      return 'å·²ç»“æŸ'\n    default:\n      return 'æœªçŸ¥'\n  }\n}\n\nconst getMessageAvatar = (message) => {\n  // è·å–å‘é€è€…å¤´åƒï¼Œä¼˜å…ˆçº§ï¼šmessage.avatar > message.data.avatar\n  const avatar = message.avatar || message.data?.avatar\n  // è¿‡æ»¤æ‰ç©ºå­—ç¬¦ä¸²å’Œæ— æ•ˆURL\n  if (avatar && avatar.trim() && avatar !== 'null' && avatar !== 'undefined') {\n    return avatar.trim()\n  }\n  return null\n}\n\nconst getMessageNickname = (message) => {\n  return message.nickname || message.data?.nickname || message.userName || message.data?.userName || 'ç”¨æˆ·'\n}\n\nconst getUserAvatar = (message) => {\n  // è·å–å½“å‰ç”¨æˆ·å¤´åƒ\n  const avatar = message.avatar || message.data?.avatar || userStore.user?.avatar\n  // è¿‡æ»¤æ‰ç©ºå­—ç¬¦ä¸²å’Œæ— æ•ˆURL\n  if (avatar && avatar.trim() && avatar !== 'null' && avatar !== 'undefined') {\n    return avatar.trim()\n  }\n  return null\n}\n\nconst getUserNickname = (message) => {\n  return message.nickname || message.data?.nickname || message.userName || message.data?.userName || userStore.userDisplayName\n}\n\n// å¤´åƒé”™è¯¯å¤„ç†\nconst handleAvatarError = (event) => {\n  console.log('å¤´åƒåŠ è½½å¤±è´¥:', event.target.src)\n  event.target.style.display = 'none'\n}\n\n// å¤´åƒåŠ è½½æˆåŠŸå¤„ç†\nconst handleAvatarLoad = (event) => {\n  console.log('å¤´åƒåŠ è½½æˆåŠŸ:', event.target.src)\n}\n\n// è‡ªåŠ¨æ ‡è®°æ¶ˆæ¯ä¸ºå·²è¯»\nconst autoMarkAsRead = async () => {\n  if (unreadCount.value > 0) {\n    try {\n      const response = await ChatApi.markMessagesAsRead()\n      if (response.success) {\n        unreadCount.value = 0\n        console.log('æ¶ˆæ¯å·²è‡ªåŠ¨æ ‡è®°ä¸ºå·²è¯»')\n      }\n    } catch (error) {\n      console.error('è‡ªåŠ¨æ ‡è®°æ¶ˆæ¯å·²è¯»å¤±è´¥:', error)\n    }\n  }\n}\n\n// é€‰æ‹©ä¼šè¯\nconst selectSession = async (session) => {\n  console.log('é€‰ä¸­ç”¨æˆ·ä¼šè¯:', session)\n  \n  // æ¸…é™¤ä¹‹å‰çš„typingçŠ¶æ€\n  clearTypingStates()\n  \n  selectedSession.value = session\n\n  // åŠ è½½è¯¥ç”¨æˆ·çš„èŠå¤©è®°å½•\n  await loadChatHistoryForSession(session.user_id)\n\n  // æ ‡è®°è¯¥ç”¨æˆ·çš„æ¶ˆæ¯ä¸ºå·²è¯»\n  if (session.unread_count > 0) {\n    await markSessionAsRead(session.user_id)\n    // æ›´æ–°ä¼šè¯åˆ—è¡¨ä¸­çš„æœªè¯»æ•°é‡\n    session.unread_count = 0\n  }\n}\n\n// åŠ è½½ç‰¹å®šä¼šè¯çš„èŠå¤©è®°å½•\nconst loadChatHistoryForSession = async (sessionId) => {\n  try {\n    console.log('åŠ è½½ç”¨æˆ·èŠå¤©è®°å½•:', sessionId)\n    // ä½¿ç”¨æ–°çš„ getUserMessages æ¥å£\n    const response = await ChatApi.getUserMessages(sessionId, {\n      limit: 50\n    })\n\n    if (response.success && response.data) {\n      messages.value = response.data.map(msg => {\n        console.log('ç”¨æˆ·æ¶ˆæ¯:', msg)\n\n        // åˆ¤æ–­æ˜¯å¦ä¸ºå®¢æœæ¶ˆæ¯çš„é€»è¾‘\n        const isCustomerService = msg.message_type === 'customer_service' ||\n          msg.role === 'admin' ||\n          msg.role === 'customer_service' ||\n          msg.is_admin_message === 1\n\n        const processedMsg = {\n          ...msg,\n          user_id: msg.user_id || msg.id,\n          isAdmin: isCustomerService,\n          avatar: msg.avatar,\n          nickname: msg.nickname || msg.username,\n          userName: msg.nickname || msg.username,\n          message_type: isCustomerService ? 'customer_service' : 'user'\n        }\n\n        return processedMsg\n      })\n\n      console.log('ç”¨æˆ·èŠå¤©è®°å½•åŠ è½½å®Œæˆ:', messages.value)\n      scrollToBottom()\n    }\n  } catch (error) {\n    console.error('åŠ è½½ç”¨æˆ·èŠå¤©è®°å½•å¤±è´¥:', error)\n    // å¦‚æœAPIä¸æ”¯æŒæŒ‰ç”¨æˆ·åŠ è½½ï¼Œå›é€€åˆ°åŠ è½½å…¨éƒ¨è®°å½•\n    await loadChatHistory()\n  }\n}\n\n// æ ‡è®°ç‰¹å®šä¼šè¯ä¸ºå·²è¯»\nconst markSessionAsRead = async (sessionId) => {\n  try {\n    const response = await ChatApi.markSessionAsRead(sessionId)\n    if (response.success) {\n      console.log('ä¼šè¯å·²æ ‡è®°ä¸ºå·²è¯»:', sessionId)\n      // æ›´æ–°æ€»çš„æœªè¯»æ•°é‡\n      await loadUnreadCount()\n    }\n  } catch (error) {\n    console.error('æ ‡è®°ä¼šè¯å·²è¯»å¤±è´¥:', error)\n    // å¦‚æœAPIä¸æ”¯æŒï¼Œä½¿ç”¨é€šç”¨çš„æ ‡è®°å·²è¯»\n    await autoMarkAsRead()\n  }\n}\n\n// è¿”å›å®¢æœæ¨¡å¼\nconst backToCustomerService = () => {\n  console.log('è¿”å›å®¢æœæ¨¡å¼')\n  \n  // æ¸…é™¤typingçŠ¶æ€\n  clearTypingStates()\n  \n  selectedSession.value = null\n  // é‡æ–°åŠ è½½é»˜è®¤çš„èŠå¤©è®°å½•\n  loadChatHistory()\n}\n\n// æ›´æ–°ä¼šè¯åˆ—è¡¨\nconst updateSessionList = (message) => {\n  const messageUserId = message.user_id\n  const sessionIndex = sessions.value.findIndex(s => s.user_id === messageUserId)\n\n  if (sessionIndex >= 0) {\n    // æ›´æ–°ç°æœ‰ä¼šè¯\n    const session = sessions.value[sessionIndex]\n    session.last_message = message.message || message.data?.message\n    session.last_message_time = new Date().toISOString()\n\n    // å¦‚æœä¸æ˜¯å½“å‰é€‰ä¸­çš„ä¼šè¯ä¸”æ¶ˆæ¯ç±»å‹æ˜¯ç”¨æˆ·æ¶ˆæ¯ï¼Œå¢åŠ æœªè¯»æ•°é‡\n    if ((!selectedSession.value || selectedSession.value.user_id !== messageUserId) &&\n      message.message_type === 'user') {\n      session.unread_count = (session.unread_count || 0) + 1\n    }\n\n    // å°†ä¼šè¯ç§»åˆ°åˆ—è¡¨é¡¶éƒ¨\n    sessions.value.splice(sessionIndex, 1)\n    sessions.value.unshift(session)\n  } else if (message.message_type === 'user') {\n    // æ–°ç”¨æˆ·å‘é€æ¶ˆæ¯ï¼Œé‡æ–°åŠ è½½ä¼šè¯åˆ—è¡¨\n    loadChatSessions()\n  }\n}\n\n// æ£€æŸ¥ç™»å½•çŠ¶æ€å’Œåˆå§‹åŒ–\nonMounted(async () => {\n  if (!userStore.isLoggedIn) {\n    // å¦‚æœæœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢\n    navigateTo('/auth/login')\n    return\n  }\n\n  // åŠ è½½é¡µé¢æ•°æ®\n  await Promise.all([\n    loadServiceStatus(),\n    loadUnreadCount(),\n    loadChatHistory(),\n    loadChatSessions()\n  ])\n  connectWebSocket()\n})\n\nonUnmounted(() => {\n  disconnectWebSocket()\n})\n</script>\n\n<style scoped>\n.glass-card-dark {\n  background: rgba(31, 41, 55, 0.8);\n  backdrop-filter: blur(20px);\n  -webkit-backdrop-filter: blur(20px);\n}\n\n/* æ»šåŠ¨æ¡æ ·å¼ */\n.overflow-y-auto::-webkit-scrollbar {\n  width: 6px;\n}\n\n.overflow-y-auto::-webkit-scrollbar-track {\n  background: rgba(55, 65, 81, 0.3);\n  border-radius: 3px;\n}\n\n.overflow-y-auto::-webkit-scrollbar-thumb {\n  background: rgba(156, 163, 175, 0.5);\n  border-radius: 3px;\n}\n\n.overflow-y-auto::-webkit-scrollbar-thumb:hover {\n  background: rgba(156, 163, 175, 0.7);\n}\n\n/* éšè—è¾“å…¥æ¡†æ»šåŠ¨æ¡ */\n.hide-scrollbar {\n  /* éšè— Webkit æµè§ˆå™¨æ»šåŠ¨æ¡ */\n  -webkit-overflow-scrolling: touch;\n  scrollbar-width: none; /* Firefox */\n  -ms-overflow-style: none; /* IE å’Œ Edge */\n}\n\n.hide-scrollbar::-webkit-scrollbar {\n  display: none; /* Chrome, Safari, Opera */\n}\n\n/* è‡ªå®šä¹‰åŠ¨ç”» */\n@keyframes fadeInUp {\n  0% {\n    opacity: 0;\n    transform: translateY(30px);\n  }\n\n  100% {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n@keyframes fadeInLeft {\n  0% {\n    opacity: 0;\n    transform: translateX(-30px);\n  }\n\n  100% {\n    opacity: 1;\n    transform: translateX(0);\n  }\n}\n\n@keyframes fadeInRight {\n  0% {\n    opacity: 0;\n    transform: translateX(30px);\n  }\n\n  100% {\n    opacity: 1;\n    transform: translateX(0);\n  }\n}\n\n@keyframes bounceGentle {\n\n  0%,\n  20%,\n  50%,\n  80%,\n  100% {\n    transform: translateY(0);\n  }\n\n  40% {\n    transform: translateY(-3px);\n  }\n\n  60% {\n    transform: translateY(-2px);\n  }\n}\n\n@keyframes pulseGentle {\n\n  0%,\n  100% {\n    transform: scale(1);\n    opacity: 1;\n  }\n\n  50% {\n    transform: scale(1.05);\n    opacity: 0.8;\n  }\n}\n\n@keyframes bounce {\n\n  0%,\n  20%,\n  53%,\n  80%,\n  100% {\n    transform: translate3d(0, 0, 0);\n  }\n\n  40%,\n  43% {\n    transform: translate3d(0, -8px, 0);\n  }\n\n  70% {\n    transform: translate3d(0, -4px, 0);\n  }\n\n  90% {\n    transform: translate3d(0, -2px, 0);\n  }\n}\n\n/* åŠ¨ç”»ç±» */\n.animate-fade-in-up {\n  animation: fadeInUp 0.8s ease-out forwards;\n}\n\n.animate-fade-in-left {\n  animation: fadeInLeft 0.8s ease-out forwards;\n  animation-delay: 0.2s;\n  opacity: 0;\n}\n\n.animate-fade-in-right {\n  animation: fadeInRight 0.8s ease-out forwards;\n  animation-delay: 0.3s;\n  opacity: 0;\n}\n\n.animate-bounce-gentle {\n  animation: bounceGentle 2s ease-in-out infinite;\n}\n\n.animate-pulse-gentle {\n  animation: pulseGentle 2s ease-in-out infinite;\n}\n\n.animate-bounce {\n  animation: bounce 1s infinite;\n}\n\n/* æ¶ˆæ¯åŠ¨ç”» */\n.message-enter-active {\n  transition: all 0.5s ease-out;\n}\n\n.message-enter-from {\n  opacity: 0;\n  transform: translateY(20px) scale(0.9);\n}\n\n.message-enter-to {\n  opacity: 1;\n  transform: translateY(0) scale(1);\n}\n\n/* ä¼šè¯é€‰ä¸­çŠ¶æ€ä¼˜åŒ– */\n.session-selected {\n  background: linear-gradient(135deg, rgba(6, 182, 212, 0.15) 0%, rgba(59, 130, 246, 0.15) 100%);\n  border: 1px solid rgba(6, 182, 212, 0.4);\n  box-shadow: 0 0 20px rgba(6, 182, 212, 0.2);\n}\n\n.session-selected::before {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  border-radius: 12px;\n  background: linear-gradient(135deg, rgba(6, 182, 212, 0.1) 0%, rgba(59, 130, 246, 0.1) 100%);\n  pointer-events: none;\n  z-index: -1;\n}\n\n/* å“åº”å¼è®¾è®¡ä¼˜åŒ– */\n@media (max-width: 1280px) {\n\n  .xl\\\\:col-span-1,\n  .xl\\\\:col-span-3 {\n    grid-column: span 1;\n  }\n\n  .grid.xl\\\\:grid-cols-4 {\n    grid-template-columns: repeat(1, minmax(0, 1fr));\n    gap: 1rem;\n  }\n}\n\n@media (max-width: 768px) {\n\n  .animate-fade-in-left,\n  .animate-fade-in-right {\n    animation-delay: 0.1s;\n  }\n\n  .h-\\\\[750px\\\\] {\n    height: 500px;\n  }\n\n  .px-6 {\n    padding-left: 1rem;\n    padding-right: 1rem;\n  }\n\n  .py-8 {\n    padding-top: 1.5rem;\n    padding-bottom: 1.5rem;\n  }\n\n  .text-4xl {\n    font-size: 2rem;\n  }\n\n  .text-2xl {\n    font-size: 1.5rem;\n  }\n}\n</style>"],"names":["_ssrRenderAttrs","_mergeProps","_ssrRenderClass","_ssrInterpolate","_ssrRenderList"],"mappings":"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"}