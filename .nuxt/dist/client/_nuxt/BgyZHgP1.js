import{_ as P}from"./Cdu_mIXq.js";import{_ as q}from"./CN_dioCB.js";import{_ as G,x as J,r as u,l as _,e as K,c as r,a as t,b as D,i as m,t as n,d as b,w as N,F as p,j as v,z as O,p as Q,v as W,o as a,k as j}from"./Cr1aFJzT.js";import{r as M}from"./By1bEtc9.js";import{u as X}from"./C8Vvw7o1.js";import{c as Y}from"./cDDxLc6a.js";import"./B3STIKjH.js";import"./CFjwhGiX.js";const Z={class:"min-h-screen bg-gradient-to-br from-gray-900 via-slate-900 to-black relative overflow-hidden"},tt={class:"container mx-auto px-6 py-8 relative z-10"},et={class:"grid md:grid-cols-3 gap-6 mb-8"},st={class:"glass-card-dark rounded-2xl border border-cyan-500/30 shadow-2xl shadow-cyan-500/20 p-6 text-center"},ot={class:"text-3xl font-bold text-cyan-400 mb-2"},rt={class:"glass-card-dark rounded-2xl border border-yellow-500/30 shadow-2xl shadow-yellow-500/20 p-6 text-center"},at={class:"text-3xl font-bold text-yellow-400 mb-2"},lt={class:"glass-card-dark rounded-2xl border border-green-500/30 shadow-2xl shadow-green-500/20 p-6 text-center"},nt={class:"text-3xl font-bold text-green-400 mb-2"},it={class:"glass-card-dark rounded-2xl border border-cyan-500/30 shadow-2xl shadow-cyan-500/20"},dt={class:"p-8"},ct={key:0,class:"text-center py-12"},ut={key:1,class:"text-center py-12"},gt={key:2,class:"space-y-6"},mt={class:"flex items-center gap-4 mb-4"},xt={class:"w-16 h-16 bg-gray-700/50 rounded-lg overflow-hidden"},bt=["src","alt"],pt={key:1,class:"w-full h-full flex items-center justify-center text-gray-500"},vt={class:"flex-1"},yt={class:"font-semibold text-white text-lg mb-1"},ft={class:"flex items-center gap-4 text-sm text-gray-400"},_t={key:0,class:"px-2 py-1 bg-green-500/20 text-green-300 text-xs rounded-full border border-green-400/30"},ht={class:"px-2 py-1 bg-blue-500/20 text-blue-300 text-xs rounded-full border border-blue-400/30"},wt={class:"flex items-center gap-2"},kt=["onClick"],Ct=["onClick"],Rt={class:"mb-4"},Dt={class:"flex items-center gap-3 mb-3"},jt={class:"flex gap-1"},Mt={class:"text-gray-300 text-sm"},zt={class:"text-gray-300 leading-relaxed"},$t={key:0,class:"grid grid-cols-4 gap-2 mb-4"},Nt=["src","alt"],St={class:"flex items-center justify-between pt-4 border-t border-gray-700/50 text-sm text-gray-400"},Tt={key:3,class:"mt-8 flex justify-center"},Lt={class:"flex items-center gap-2"},Vt=["onClick"],At={key:0,class:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4"},Et={class:"glass-card-dark rounded-2xl border border-cyan-500/30 shadow-2xl shadow-cyan-500/20 w-full max-w-2xl max-h-[90vh] overflow-y-auto"},Bt={class:"p-8"},Ft={class:"flex items-center gap-2"},Ut=["onClick"],Ht={key:0,class:"ml-4 text-white font-medium"},It={class:"flex justify-end space-x-4 pt-6"},Pt=["disabled"],qt={key:0,class:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"},Gt={key:1,class:"bi bi-check-circle"},Jt={__name:"my-reviews",setup(Kt){const S=J(),{message:i}=Y(["message"]),d=u([]),g=u(null),h=u(!1),w=u(1),k=u(!1),l=u({id:null,rating:0,comment:""}),x=u(!1),T=_(()=>d.value.length),L=_(()=>d.value.length===0?0:d.value.reduce((e,f)=>e+f.rating,0)/d.value.length),V=_(()=>d.value.filter(o=>o.verified_purchase).length),A=_(()=>{if(!g.value)return[];const o=[];for(let e=1;e<=g.value.total_pages;e++)o.push(e);return o}),y=async(o=1)=>{try{h.value=!0,w.value=o;const e=await M.getMyReviews({page:o,limit:10});e.success?(d.value=e.data.reviews,g.value=e.data.pagination):i.error("加载评论失败")}catch(e){console.error("加载评论失败:",e),i.error("加载评论失败，请重试")}finally{h.value=!1}},E=o=>new Date(o).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),z=o=>({1:"非常不满意",2:"不满意",3:"一般",4:"满意",5:"非常满意"})[o]||"",B=o=>({pending:"审核中",approved:"已发布",rejected:"已拒绝"})[o]||o,F=o=>{const e=new Date(o.created_at);return(new Date().getTime()-e.getTime())/(1e3*60*60)<=24&&o.status==="approved"},U=o=>{l.value={id:o.id,rating:o.rating,comment:o.comment},k.value=!0},C=()=>{k.value=!1,l.value={id:null,rating:0,comment:""}},H=async()=>{if(!(!l.value.rating||!l.value.comment.trim()))try{x.value=!0;const o=await M.updateReview(l.value.id,{rating:l.value.rating,comment:l.value.comment.trim()});o.success?(i.success("评论更新成功"),C(),y(w.value)):i.error(o.message||"更新失败")}catch(o){console.error("更新评论失败:",o),i.error("更新失败，请重试")}finally{x.value=!1}},I=async o=>{if(confirm("确定要删除这条评论吗？此操作无法撤销。"))try{const e=await M.deleteReview(o);e.success?(i.success("评论已删除"),y(w.value)):i.error(e.message||"删除失败")}catch(e){console.error("删除评论失败:",e),i.error("删除失败，请重试")}};return K(()=>{S.isLoggedIn&&y()}),X({title:"我的评论 - xlCig",meta:[{name:"description",content:"管理您发表的所有产品评论，编辑和删除评论"}]}),(o,e)=>{const f=P,R=q;return a(),r("div",Z,[e[20]||(e[20]=t("div",{class:"fixed inset-0 pointer-events-none"},[t("div",{class:"absolute top-20 left-20 w-96 h-96 bg-gradient-to-r from-cyan-500/20 to-blue-500/20 rounded-full filter blur-3xl animate-pulse"}),t("div",{class:"absolute bottom-20 right-20 w-80 h-80 bg-gradient-to-r from-purple-500/20 to-pink-500/20 rounded-full filter blur-3xl animate-pulse delay-1000"})],-1)),D(f,{"show-back-button":!0,"show-nav-menu":!0,"show-breadcrumb":!0,"show-location":!1,"show-search-button":!1,"show-notification-button":!0,"show-decorations":!1,"logo-size":"medium","current-page-title":"我的评论"}),t("div",tt,[e[14]||(e[14]=t("div",{class:"text-center mb-12"},[t("h1",{class:"text-4xl font-bold bg-gradient-to-r from-cyan-400 to-blue-400 bg-clip-text text-transparent mb-4"}," 我的评论 "),t("p",{class:"text-gray-300 text-lg"},"管理您发表的所有产品评论")],-1)),t("div",et,[t("div",st,[t("div",ot,n(T.value),1),e[1]||(e[1]=t("div",{class:"text-gray-300"},"总评论数",-1))]),t("div",rt,[t("div",at,n(L.value.toFixed(1)),1),e[2]||(e[2]=t("div",{class:"text-gray-300"},"平均评分",-1))]),t("div",lt,[t("div",nt,n(V.value),1),e[3]||(e[3]=t("div",{class:"text-gray-300"},"已验证评论",-1))])]),t("div",it,[e[13]||(e[13]=t("div",{class:"px-8 py-6 border-b border-gray-700/50"},[t("h2",{class:"text-2xl font-bold text-white flex items-center gap-3"},[t("i",{class:"bi bi-chat-dots text-cyan-400"}),b(" 评论列表 ")])],-1)),t("div",dt,[h.value?(a(),r("div",ct,e[4]||(e[4]=[t("div",{class:"w-12 h-12 border-4 border-cyan-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"},null,-1),t("p",{class:"text-gray-300"},"正在加载评论...",-1)]))):d.value.length===0?(a(),r("div",ut,[e[6]||(e[6]=t("div",{class:"text-6xl mb-4 text-gray-500"},[t("i",{class:"bi bi-chat-x"})],-1)),e[7]||(e[7]=t("h3",{class:"text-xl font-semibold text-white mb-2"},"暂无评论",-1)),e[8]||(e[8]=t("p",{class:"text-gray-400 mb-6"},"您还没有发表过任何评论",-1)),D(R,{to:"/products",class:"inline-flex items-center px-6 py-3 bg-cyan-600 text-white font-medium rounded-lg hover:bg-cyan-500 transition-all duration-300"},{default:N(()=>e[5]||(e[5]=[t("i",{class:"bi bi-plus-circle mr-2"},null,-1),b(" 去购物并评论 ")])),_:1,__:[5]})])):(a(),r("div",gt,[(a(!0),r(p,null,v(d.value,s=>(a(),r("div",{key:s.id,class:"p-6 bg-gradient-to-r from-gray-800/40 to-gray-700/40 rounded-xl border border-gray-600/30 hover:border-cyan-400/50 transition-all duration-300"},[t("div",mt,[t("div",xt,[s.product_images&&s.product_images.length>0?(a(),r("img",{key:0,src:s.product_images[0],alt:s.product_name,class:"w-full h-full object-contain p-1"},null,8,bt)):(a(),r("div",pt,e[9]||(e[9]=[t("i",{class:"bi bi-image text-2xl"},null,-1)])))]),t("div",vt,[t("h3",yt,n(s.product_name),1),t("div",ft,[t("span",null,"发表于: "+n(E(s.created_at)),1),s.verified_purchase?(a(),r("span",_t," 已验证购买 ")):m("",!0),t("span",ht,n(B(s.status)),1)])]),t("div",wt,[F(s)?(a(),r("button",{key:0,onClick:c=>U(s),class:"p-2 text-gray-400 hover:text-cyan-400 transition-colors duration-200"},e[10]||(e[10]=[t("i",{class:"bi bi-pencil"},null,-1)]),8,kt)):m("",!0),t("button",{onClick:c=>I(s.id),class:"p-2 text-gray-400 hover:text-red-400 transition-colors duration-200"},e[11]||(e[11]=[t("i",{class:"bi bi-trash"},null,-1)]),8,Ct)])]),t("div",Rt,[t("div",Dt,[t("div",jt,[(a(),r(p,null,v(5,c=>t("i",{key:c,class:j([c<=s.rating?"text-yellow-400":"text-gray-600","bi bi-star-fill text-lg"])},null,2)),64))]),t("span",Mt,n(z(s.rating)),1)]),t("p",zt,n(s.comment),1)]),s.images&&s.images.length>0?(a(),r("div",$t,[(a(!0),r(p,null,v(s.images,(c,$)=>(a(),r("img",{key:$,src:c,alt:`评论图片${$+1}`,class:"w-full h-20 object-cover rounded-lg border border-gray-600/30"},null,8,Nt))),128))])):m("",!0),t("div",St,[t("span",null,"获得 "+n(s.helpful_count)+" 个赞",1),D(R,{to:`/products/${s.product_id}`,class:"text-cyan-400 hover:text-cyan-300 transition-colors duration-200"},{default:N(()=>e[12]||(e[12]=[b(" 查看产品详情 → ")])),_:2,__:[12]},1032,["to"])])]))),128))])),g.value&&g.value.total_pages>1?(a(),r("div",Tt,[t("div",Lt,[(a(!0),r(p,null,v(A.value,s=>(a(),r("button",{key:s,onClick:c=>y(s),class:j(["px-4 py-2 rounded-lg font-medium transition-all duration-200",s===g.value.current_page?"bg-cyan-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"])},n(s),11,Vt))),128))])])):m("",!0)])])]),k.value?(a(),r("div",At,[t("div",Et,[t("div",Bt,[t("div",{class:"flex items-center justify-between mb-6"},[e[16]||(e[16]=t("h3",{class:"text-2xl font-bold text-white flex items-center gap-3"},[t("i",{class:"bi bi-pencil text-cyan-400"}),b(" 编辑评论 ")],-1)),t("button",{onClick:C,class:"text-gray-400 hover:text-white"},e[15]||(e[15]=[t("i",{class:"bi bi-x-lg text-2xl"},null,-1)]))]),t("form",{onSubmit:O(H,["prevent"]),class:"space-y-6"},[t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-bold text-white mb-4"},"评分",-1)),t("div",Ft,[(a(),r(p,null,v(5,s=>t("button",{key:s,type:"button",onClick:c=>l.value.rating=s,class:j(["text-3xl transition-all duration-200 hover:scale-110",s<=l.value.rating?"text-yellow-400":"text-gray-600 hover:text-yellow-300"])},e[17]||(e[17]=[t("i",{class:"bi bi-star-fill"},null,-1)]),10,Ut)),64)),l.value.rating>0?(a(),r("span",Ht,n(z(l.value.rating)),1)):m("",!0)])]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-bold text-white mb-4"},"评论内容",-1)),Q(t("textarea",{"onUpdate:modelValue":e[0]||(e[0]=s=>l.value.comment=s),required:"",rows:"5",placeholder:"请分享您对这款产品的使用体验...",class:"w-full px-4 py-3 bg-gray-800/50 border border-gray-600/50 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 text-white placeholder-gray-400 resize-none"},null,512),[[W,l.value.comment]])]),t("div",It,[t("button",{type:"button",onClick:C,class:"px-6 py-3 border border-gray-600 text-gray-300 hover:text-white hover:border-gray-500 rounded-lg font-medium transition-colors duration-300"}," 取消 "),t("button",{type:"submit",disabled:x.value,class:"px-6 py-3 bg-cyan-600 hover:bg-cyan-500 disabled:bg-gray-600 text-white rounded-lg font-medium transition-colors duration-300 flex items-center gap-2"},[x.value?(a(),r("div",qt)):(a(),r("i",Gt)),b(" "+n(x.value?"更新中...":"更新评论"),1)],8,Pt)])],32)])])])):m("",!0)])}}},se=G(Jt,[["__scopeId","data-v-e32176e9"]]);export{se as default};
