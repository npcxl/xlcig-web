import{_ as Le}from"./DtcfTgNo.js";import{_ as De,G as He,r as C,e as fe,f as Re,D as Pe,g as Be,c,a,b as he,d as N,p as f,t as v,s as _,F as L,j as D,i as Q,w as Fe,R as Je,q as Ve,C as Ke,m as Ge,x as qe,n as X,o as d,k as xe}from"./D7rkgqT2.js";import{a as b}from"./CFjwhGiX.js";import{u as Qe}from"./nSjweiC5.js";import{s as Xe}from"./x_rD_Ya3.js";import"./Bg25Pqs-.js";import"./C9iI_EUL.js";import"./B5gbdNuQ.js";class O{static async getChatHistory(n={}){try{return await b.getWithParams("/chat/history",n)}catch(i){throw console.error("è·å–èŠå¤©å†å²å¤±è´¥:",i),i}}static async getChatSessions(n={}){try{return await b.getWithParams("/chat/sessions",n)}catch(i){throw console.error("è·å–èŠå¤©ä¼šè¯å¤±è´¥:",i),i}}static async closeChatSession(n,i){try{return await b.post(`/chat/sessions/${n}/close`,i)}catch(g){throw console.error("ç»“æŸèŠå¤©ä¼šè¯å¤±è´¥:",g),g}}static async getServiceStatus(){try{return await b.get("/chat/service/status")}catch(n){throw console.error("è·å–å®¢æœçŠ¶æ€å¤±è´¥:",n),n}}static async getUnreadCount(){try{return await b.get("/chat/unread-count")}catch(n){throw console.error("è·å–æœªè¯»æ¶ˆæ¯æ•°é‡å¤±è´¥:",n),n}}static async markMessagesAsRead(n){try{return await b.post("/chat/mark-read",{messageIds:n})}catch(i){throw console.error("æ ‡è®°æ¶ˆæ¯å·²è¯»å¤±è´¥:",i),i}}static async sendSystemMessage(n,i){try{return await b.post("/chat/system/message",{message:n,target_user_id:i})}catch(g){throw console.error("å‘é€ç³»ç»Ÿæ¶ˆæ¯å¤±è´¥:",g),g}}static async getChatStats(){try{return await b.get("/chat/admin/stats")}catch(n){throw console.error("è·å–èŠå¤©ç»Ÿè®¡å¤±è´¥:",n),n}}static async getUserSessions(n={}){try{return await b.getWithParams("/chat/user-sessions",n)}catch(i){throw console.error("è·å–ç”¨æˆ·ä¼šè¯åˆ—è¡¨å¤±è´¥:",i),i}}static async getUserMessages(n,i={}){try{return await b.getWithParams(`/chat/user-messages/${n}`,i)}catch(g){throw console.error("è·å–ç”¨æˆ·èŠå¤©è®°å½•å¤±è´¥:",g),g}}static async sendMessage(n,i){try{return await b.post("/chat/send-message",{message:n,target_user_id:i})}catch(g){throw console.error("å‘é€æ¶ˆæ¯å¤±è´¥:",g),g}}static async markSessionAsRead(n){try{return await b.post("/chat/mark-read",{})}catch(i){throw console.error("æ ‡è®°ä¼šè¯å·²è¯»å¤±è´¥:",i),i}}static async getUserOnlineStatus(n){try{const i=n?{userIds:n}:{};return await b.getWithParams("/chat/users/online-status",i)}catch(i){throw console.error("è·å–ç”¨æˆ·åœ¨çº¿çŠ¶æ€å¤±è´¥:",i),i}}static async getConnectionDetails(){try{return await b.get("/chat/admin/connections")}catch(n){throw console.error("è·å–è¿æ¥è¯¦æƒ…å¤±è´¥:",n),n}}}const Ye={class:"min-h-screen bg-gradient-to-br from-gray-900 via-slate-900 to-black"},Ze={class:"relative z-10"},et={class:"container mx-auto px-6 py-8"},tt={class:"glass-card-dark rounded-2xl p-8 border border-cyan-500/30 shadow-2xl shadow-cyan-500/20 animate-fade-in-up"},at={class:"flex items-center justify-between"},st={class:"flex items-center gap-4"},rt={class:"flex items-center gap-6"},nt={class:"flex items-center gap-2"},ot={class:"text-sm text-gray-300"},lt={class:"flex items-center gap-2"},it={class:"relative z-10"},ct={class:"container mx-auto px-6 py-4"},dt={class:"glass-card-dark rounded-2xl p-6 border border-cyan-500/30 shadow-2xl shadow-cyan-500/20 animate-fade-in-up"},ut={class:"flex flex-wrap items-center justify-between gap-4"},vt={class:"flex items-center gap-4"},mt={class:"flex items-center gap-2"},yt={class:"text-cyan-300"},gt={key:0,class:"flex items-center gap-2"},ft={class:"flex items-center gap-2"},ht={class:"flex items-center gap-2 text-sm text-gray-400"},xt={class:"flex items-center gap-2 text-sm text-gray-400"},pt={class:"flex items-center gap-2"},_t={class:"text-xs text-gray-400"},bt={class:"container mx-auto px-6 py-8 relative z-10"},wt={class:"grid grid-cols-1 xl:grid-cols-4 gap-6"},kt={class:"xl:col-span-1"},St={class:"glass-card-dark rounded-2xl border border-cyan-500/30 shadow-2xl shadow-cyan-500/20 overflow-hidden animate-fade-in-left h-[750px] flex flex-col"},Ct={class:"px-6 py-4 border-b border-gray-700/50 bg-gray-800/30"},Nt={class:"flex items-center justify-between"},It={class:"text-xs text-gray-400"},Ut={key:0,class:"text-cyan-400 ml-2"},jt={class:"flex items-center gap-2"},Mt={class:"flex-1 overflow-y-auto"},At={key:0,class:"flex flex-col items-center justify-center h-full text-center p-8"},Ot={key:1,class:"p-4 space-y-3"},$t=["onClick"],Wt={key:0,class:"absolute top-3 left-3 w-3 h-3 bg-cyan-400 rounded-full animate-pulse shadow-lg"},Tt={key:1,class:"absolute top-3 right-3 min-w-[20px] h-5 bg-red-500 rounded-full flex items-center justify-center px-1"},zt={class:"text-xs text-white font-semibold"},Et={class:"flex items-center space-x-4"},Lt={class:"relative flex-shrink-0"},Dt=["src","alt"],Ht={key:1,class:"w-full h-full bg-gradient-to-br from-gray-600 to-gray-700 flex items-center justify-center"},Rt={class:"absolute -bottom-1 -right-1 w-5 h-5 bg-gray-800 rounded-full flex items-center justify-center border border-gray-700"},Pt={class:"flex-1 min-w-0"},Bt={class:"flex items-center justify-between mb-2"},Ft={class:"text-white font-semibold text-base truncate"},Jt={class:"text-xs text-gray-500 flex-shrink-0 ml-2"},Vt={class:"mb-2"},Kt={class:"text-sm text-gray-400 truncate leading-relaxed"},Gt={class:"flex items-center justify-between"},qt={class:"flex items-center space-x-2"},Qt={key:0,class:"flex items-center"},Xt={class:"flex mr-1"},Yt={class:"text-xs text-gray-500"},Zt={class:"flex items-center gap-1"},ea={class:"xl:col-span-3"},ta={class:"glass-card-dark rounded-2xl border border-cyan-500/30 shadow-2xl shadow-cyan-500/20 overflow-hidden animate-fade-in-right h-[750px] flex flex-col"},aa={class:"px-6 py-4 border-b border-gray-700/50 bg-gray-800/30"},sa={class:"flex items-center justify-between"},ra={class:"flex items-center gap-4"},na=["src","alt"],oa={class:"text-xl font-semibold text-white flex items-center gap-2"},la={key:0,class:"bi bi-patch-check-fill text-cyan-400 text-lg"},ia={class:"text-sm text-gray-400 flex items-center gap-2"},ca={class:"flex items-center gap-3"},da={class:"flex items-center gap-2 px-3 py-1 rounded-lg bg-gray-700/30"},ua={class:"text-xs text-gray-400 font-medium"},va={key:0,class:"text-center py-16"},ma={class:"text-2xl font-bold text-white mb-3"},ya={class:"text-gray-400 mb-8 text-lg leading-relaxed max-w-md mx-auto"},ga={class:"flex flex-wrap justify-center gap-3 max-w-2xl mx-auto"},fa=["onClick"],ha={key:1,class:"mb-6 animate-fade-in-up"},xa={class:"space-y-4"},pa={key:0,class:"flex items-start gap-3 max-w-[70%]"},_a={class:"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 overflow-hidden border border-gray-600/30"},ba=["src","alt"],wa={class:"bg-gray-700/50 border border-gray-600/30 rounded-2xl rounded-tl-sm p-3 text-white"},ka={class:"flex items-center gap-2 mt-1 ml-1"},Sa={class:"text-xs text-gray-500"},Ca={key:1,class:"flex items-start gap-3 max-w-[70%] flex-row-reverse"},Na={class:"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 overflow-hidden border border-cyan-500/30"},Ia=["src","alt"],Ua={key:1,class:"w-full h-full bg-gradient-to-r from-cyan-600 to-blue-600 rounded-full flex items-center justify-center"},ja={class:"text-right"},Ma={class:"bg-gradient-to-r from-cyan-600 to-blue-600 rounded-2xl rounded-tr-sm p-3 text-white"},Aa={class:"flex items-center gap-2 mt-1 justify-end mr-1"},Oa={class:"text-xs text-gray-500"},$a={class:"text-xs text-cyan-400"},Wa={key:0,class:"flex justify-start mt-4"},Ta={class:"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 overflow-hidden border border-gray-600/30"},za=["src","alt"],Ea={key:1,class:"w-full h-full bg-gradient-to-r from-green-500 to-emerald-500 rounded-full flex items-center justify-center animate-pulse-gentle"},La={class:"flex items-center gap-2 mt-1 ml-1"},Da={class:"text-xs text-green-400"},Ha={class:"px-6 py-4 border-t border-gray-700/50 bg-gray-800/20"},Ra={class:"flex items-center justify-between mb-3"},Pa={class:"flex items-center gap-3"},Ba={key:0,class:"text-xs text-gray-500"},Fa={class:"flex items-end gap-3"},Ja={class:"flex-1 relative"},Va=["onKeydown","disabled"],Ka={key:0,class:"absolute -top-6 left-2 text-xs text-cyan-400 bg-gray-800/80 px-2 py-1 rounded-lg"},Ga=["disabled"],qa={__name:"customer-service",setup(pe){const n=He(),i=C(!1),g=C(!1),j=C(new Map),I=C(0),M=C(""),w=C([]),k=C([]),H=C(),l=C(null),T=C({adminOnline:!1,adminCount:0,totalUsers:0,normalUserCount:0});let y=null,R=null;const _e=["ä½ å¥½ï¼Œè¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©æ‚¨çš„ï¼Ÿ","æˆ‘æƒ³äº†è§£äº§å“ä¿¡æ¯","è®¢å•ç›¸å…³é—®é¢˜","æŠ€æœ¯æ”¯æŒ"],be=fe(()=>n.isLoggedIn),S=fe(()=>l.value?{name:l.value.displayName||l.value.user_nickname||l.value.user_name||`ç”¨æˆ· #${l.value.user_id}`,avatar:l.value.avatar||l.value.user_avatar,status:l.value.isOnline?"åœ¨çº¿ - ç”¨æˆ·å¯¹è¯":"ç¦»çº¿ - ç”¨æˆ·å¯¹è¯",isCustomerService:!1,isOnline:l.value.isOnline,userId:l.value.user_id,sessionId:l.value.id}:{name:"xlCig å®¢æœå›¢é˜Ÿ",avatar:null,status:T.value.adminOnline?"åœ¨çº¿ - å¹³å‡å“åº”æ—¶é—´ < 1åˆ†é’Ÿ":"ç¦»çº¿ - æˆ‘ä»¬ä¼šå°½å¿«å›å¤æ‚¨çš„æ¶ˆæ¯",isCustomerService:!0});Qe({title:"åœ¨çº¿å®¢æœ - xlCig",meta:[{name:"description",content:"ä¸“ä¸šçš„åœ¨çº¿å®¢æœæœåŠ¡ï¼Œä¸ºæ‚¨æä¾›å®æ—¶å¸®åŠ©å’Œæ”¯æŒ"}]});const Y=()=>{if(!be.value||!n.token){console.error("ç”¨æˆ·æœªç™»å½•ï¼Œæ— æ³•è¿æ¥WebSocket");return}try{const e=`ws://192.168.11.194:9999/websocket?token=${n.token}`;console.log("æ­£åœ¨è¿æ¥WebSocket:",e),y=new WebSocket(e),y.onopen=()=>{console.log("WebSocketè¿æ¥æˆåŠŸ"),i.value=!0,ke(),setTimeout(()=>{y&&y.readyState===WebSocket.OPEN&&(y.send(JSON.stringify({type:"get_users_status",data:{}})),console.log("å·²è¯·æ±‚è·å–ç”¨æˆ·åœ¨çº¿çŠ¶æ€"))},1e3)},y.onmessage=t=>{try{const r=JSON.parse(t.data);Se(r)}catch(r){console.error("è§£æWebSocketæ¶ˆæ¯å¤±è´¥:",r)}},y.onclose=()=>{console.log("WebSocketè¿æ¥å…³é—­"),i.value=!1,Z(),setTimeout(()=>{console.log("å°è¯•é‡æ–°è¿æ¥WebSocket..."),Y()},3e3)},y.onerror=t=>{console.error("WebSocketè¿æ¥é”™è¯¯:",t),i.value=!1}}catch(e){console.error("åˆ›å»ºWebSocketè¿æ¥å¤±è´¥:",e)}},we=()=>{y&&(y.close(),y=null),Z(),i.value=!1},ke=()=>{R=Xe(()=>{y&&y.readyState===WebSocket.OPEN&&y.send(JSON.stringify({type:"ping"}))},3e4)},Z=()=>{R&&(clearInterval(R),R=null)},Se=e=>{var t,r,s,o,u,m,h,p,$,x,U,ue,ve,me,ye,ge;switch(console.log("æ”¶åˆ°WebSocketæ¶ˆæ¯:",e),e.type){case"user_info":console.log("ç”¨æˆ·ä¿¡æ¯:",e.data),I.value=e.data.unreadCount||0,e.data.stats&&(T.value=e.data.stats);break;case"message":const q=e.isAdmin||((t=e.data)==null?void 0:t.isAdmin)||((r=e.data)==null?void 0:r.isCustomerService)||((s=e.data)==null?void 0:s.role)==="admin"||((o=e.data)==null?void 0:o.role)==="customer_service",W={...e,user_id:e.user_id||((u=e.data)==null?void 0:u.user_id)||((m=e.data)==null?void 0:m.userId),avatar:e.avatar||((h=e.data)==null?void 0:h.avatar),nickname:e.nickname||((p=e.data)==null?void 0:p.nickname)||(($=e.data)==null?void 0:$.userName),userName:e.userName||((x=e.data)==null?void 0:x.userName),isAdmin:q,message_type:e.message_type||(q?"customer_service":"user"),...q&&{senderId:((U=e.data)==null?void 0:U.userId)||e.userId||((ue=e.data)==null?void 0:ue.senderId),data:{...e.data,userId:((ve=e.data)==null?void 0:ve.userId)||e.userId,senderId:((me=e.data)==null?void 0:me.senderId)||((ye=e.data)==null?void 0:ye.userId)}}};if(console.log("å¤„ç†åçš„æ¶ˆæ¯:",W),l.value){const A=W.user_id||((ge=W.data)==null?void 0:ge.targetUserId);A===l.value.user_id?(w.value.push(W),E()):console.log("æ¶ˆæ¯ä¸å±äºå½“å‰é€‰ä¸­ç”¨æˆ·ï¼Œä¸æ˜¾ç¤º:",A,"å½“å‰ç”¨æˆ·:",l.value.user_id)}else w.value.push(W),E();X(()=>{de()}),W.user_id&&Ee(W);break;case"typing":console.log("æ”¶åˆ°è¾“å…¥çŠ¶æ€æ¶ˆæ¯:",e.data),te(e.data,!0);break;case"stop_typing":console.log("æ”¶åˆ°åœæ­¢è¾“å…¥æ¶ˆæ¯:",e.data),te(e.data,!1);break;case"message_read":I.value=e.data.unreadCount||0;break;case"user_online":console.log("ç”¨æˆ·ä¸Šçº¿:",e.data),P(e.data.userId||e.data.user_id,!0,e.data);break;case"user_offline":console.log("ç”¨æˆ·ä¸‹çº¿:",e.data),P(e.data.userId||e.data.user_id,!1,e.data);break;case"user_status_update":if(console.log("ç”¨æˆ·çŠ¶æ€æ›´æ–°:",e.data),e.data&&(e.data.userId||e.data.user_id)){const A=e.data.isOnline!==void 0?e.data.isOnline:!0;P(e.data.userId||e.data.user_id,A,e.data)}break;case"users_status_response":console.log("æ”¶åˆ°ç”¨æˆ·çŠ¶æ€åˆ—è¡¨:",e.data),e.data&&Array.isArray(e.data.users)&&e.data.users.forEach(A=>{P(A.userId||A.user_id,A.isOnline,A)});break;case"error":console.error("WebSocketé”™è¯¯:",e.data);break}},ee=()=>{j.value.clear(),g.value=!1,console.log("å·²æ¸…é™¤æ‰€æœ‰typingçŠ¶æ€")},te=(e,t)=>{var o;const r=e.userId||e.user_id||e.senderId,s=e.targetUserId||e.target_user_id;console.log("å¤„ç†è¾“å…¥çŠ¶æ€:",{userId:r,targetUserId:s,isTyping:t,currentSession:(o=l.value)==null?void 0:o.user_id}),l.value?(r===l.value.user_id||s===l.value.user_id)&&(t?(j.value.set(r,{nickname:e.nickname||e.userName||"ç”¨æˆ·",avatar:e.avatar,timestamp:Date.now()}),t.value=!0,console.log(`ç”¨æˆ· ${r} å¼€å§‹è¾“å…¥`)):(j.value.delete(r),t.value=j.value.size>0,console.log(`ç”¨æˆ· ${r} åœæ­¢è¾“å…¥`))):t?(j.value.set(r,{nickname:e.nickname||e.userName||"ç”¨æˆ·",avatar:e.avatar,timestamp:Date.now()}),t.value=!0,console.log(`ç”¨æˆ· ${r} å¼€å§‹è¾“å…¥ï¼ˆå›¢é˜Ÿæ¨¡å¼ï¼‰`)):(j.value.delete(r),t.value=j.value.size>0,console.log(`ç”¨æˆ· ${r} åœæ­¢è¾“å…¥ï¼ˆå›¢é˜Ÿæ¨¡å¼ï¼‰`))},P=(e,t,r={})=>{if(!e)return;console.log(`æ›´æ–°ç”¨æˆ· ${e} åœ¨çº¿çŠ¶æ€:`,t,r);const s=k.value.findIndex(o=>o.user_id===e);if(s>=0){const o=k.value[s],u=o.isOnline;if(o.isOnline=t,r.userName&&r.userName!==o.user_name&&(o.user_name=r.userName,o.displayName=r.userName),r.nickname&&r.nickname!==o.user_nickname&&(o.user_nickname=r.nickname,o.displayName=r.nickname),r.avatar&&r.avatar!==o.avatar&&(o.avatar=r.avatar,o.user_avatar=r.avatar),u!==t){const m=o.displayName||o.user_nickname||o.user_name||`ç”¨æˆ· #${e}`;console.log(`ğŸ“± ${m} ${t?"ğŸŸ¢ ä¸Šçº¿äº†":"ğŸ”´ ä¸‹çº¿äº†"}`)}console.log(`ä¼šè¯åˆ—è¡¨ä¸­ç”¨æˆ· ${e} çŠ¶æ€å·²æ›´æ–°:`,o)}else t&&(console.log(`æ–°ç”¨æˆ· ${e} ä¸Šçº¿ï¼Œé‡æ–°åŠ è½½ä¼šè¯åˆ—è¡¨`),z());l.value&&l.value.user_id===e&&(l.value.isOnline=t,r.userName&&(l.value.user_name=r.userName),r.nickname&&(l.value.user_nickname=r.nickname),r.avatar&&(l.value.avatar=r.avatar,l.value.user_avatar=r.avatar),console.log(`å½“å‰é€‰ä¸­ç”¨æˆ· ${e} çŠ¶æ€å·²æ›´æ–°`,l.value))},Ce=e=>{const t=e.target;t.style.height="auto",t.style.height=Math.min(t.scrollHeight,128)+"px"},J=async()=>{var t,r,s,o,u,m,h,p,$;if(!M.value.trim())return;const e=M.value.trim();try{if(l.value){if(console.log("å‘ç”¨æˆ·å‘é€æ¶ˆæ¯:",l.value.user_id,e),(await O.sendMessage(e,l.value.user_id)).success){const U={id:Date.now(),user_id:l.value.user_id,senderId:(t=n.user)==null?void 0:t.id,message:e,message_type:"customer_service",isAdmin:!0,avatar:(r=n.user)==null?void 0:r.avatar,nickname:n.userDisplayName,userName:n.userDisplayName,timestamp:Date.now(),created_at:new Date().toISOString(),data:{userId:(s=n.user)==null?void 0:s.id,userName:n.userDisplayName,isAdmin:!0}};w.value.push(U),console.log("æ¶ˆæ¯å‘é€æˆåŠŸï¼Œå·²æ·»åŠ åˆ°æœ¬åœ°æ˜¾ç¤º")}}else{if(!i.value||!y){console.error("WebSocketæœªè¿æ¥");return}const x={type:"message",data:{message:e,user_id:(o=n.user)==null?void 0:o.id,userId:(u=n.user)==null?void 0:u.id}};y.send(JSON.stringify(x));const U=(m=n.user)==null?void 0:m.avatar;w.value.push({...x,data:{...x.data,userId:(h=n.user)==null?void 0:h.id,userName:n.userDisplayName,isAdmin:!1,avatar:U},user_id:(p=n.user)==null?void 0:p.id,timestamp:Date.now(),isAdmin:!1,message_type:"user",avatar:U,nickname:(($=n.user)==null?void 0:$.nickname)||n.userDisplayName,userName:n.userDisplayName})}M.value="",X(()=>{const x=document.querySelector("textarea");x&&(x.style.height="48px")}),E(),ae()}catch(x){console.error("å‘é€æ¶ˆæ¯å¤±è´¥:",x)}},Ne=e=>{M.value=e,J()},B=C(!1),Ie=()=>{var e,t,r,s,o,u,m;if(console.log("è¾“å…¥æ¡†è·å¾—ç„¦ç‚¹"),B.value=!0,!(!i.value||!y))try{y.send(JSON.stringify({type:"typing",data:{userId:(e=n.user)==null?void 0:e.id,userName:n.userDisplayName,nickname:((t=n.user)==null?void 0:t.nickname)||n.userDisplayName,avatar:(r=n.user)==null?void 0:r.avatar,targetUserId:(s=l.value)==null?void 0:s.user_id,chatMode:l.value?"user_conversation":"customer_service",isAdmin:((o=n.user)==null?void 0:o.role)==="admin",isCustomerService:((u=n.user)==null?void 0:u.role)==="admin"||((m=n.user)==null?void 0:m.role)==="customer_service"}}))}catch(h){console.error("å‘é€è¾“å…¥çŠ¶æ€å¤±è´¥:",h)}},Ue=()=>{console.log("è¾“å…¥æ¡†å¤±å»ç„¦ç‚¹"),B.value=!1,setTimeout(()=>{B.value||ae()},500)},ae=()=>{var e,t,r,s,o,u,m;if(!(!i.value||!y))try{y.send(JSON.stringify({type:"stop_typing",data:{userId:(e=n.user)==null?void 0:e.id,userName:n.userDisplayName,nickname:((t=n.user)==null?void 0:t.nickname)||n.userDisplayName,avatar:(r=n.user)==null?void 0:r.avatar,targetUserId:(s=l.value)==null?void 0:s.user_id,chatMode:l.value?"user_conversation":"customer_service",isAdmin:((o=n.user)==null?void 0:o.role)==="admin",isCustomerService:((u=n.user)==null?void 0:u.role)==="admin"||((m=n.user)==null?void 0:m.role)==="customer_service"}}))}catch(h){console.error("å‘é€åœæ­¢è¾“å…¥çŠ¶æ€å¤±è´¥:",h)}},V=async()=>{try{const e=await O.getChatHistory({limit:50});e.success&&e.data&&(w.value=e.data.map(t=>{var o,u;console.log("å†å²æ¶ˆæ¯:",t);const r=t.message_type==="customer_service"||t.role==="admin"||t.role==="customer_service",s={...t,user_id:t.user_id||t.id,isAdmin:r,avatar:t.avatar||t.user_avatar,nickname:t.nickname||t.user_nickname||t.username,userName:t.nickname||t.user_nickname||t.username,message_type:r?"customer_service":"user"};return console.log("å¤„ç†åçš„å†å²æ¶ˆæ¯:",s,{isCustomerService:r,userId:t.user_id,currentUserId:(o=n.user)==null?void 0:o.id,isCurrentUser:t.user_id===((u=n.user)==null?void 0:u.id)}),s}),console.log("æ‰€æœ‰å¤„ç†åçš„å†å²æ¶ˆæ¯:",w.value),E())}catch(e){console.error("åŠ è½½èŠå¤©å†å²å¤±è´¥:",e)}},z=async()=>{try{const e=await O.getUserSessions({limit:20});e.success&&e.data&&(k.value=e.data.map(t=>{console.log("åŸå§‹ç”¨æˆ·ä¼šè¯æ•°æ®:",t);const r={...t,id:t.user_id,user_avatar:t.avatar,user_nickname:t.nickname,user_name:t.nickname||t.username,unread_count:t.unread_count||0,last_message:t.last_message,last_message_time:t.last_message_time,last_message_type:t.last_message_type,isOnline:t.isOnline||!1,displayName:t.displayName||t.nickname||t.username,status:"active"};return console.log("å¤„ç†åçš„ç”¨æˆ·ä¼šè¯æ•°æ®:",r),r}))}catch(e){console.error("åŠ è½½ç”¨æˆ·ä¼šè¯åˆ—è¡¨å¤±è´¥:",e)}},je=async()=>{try{const e=await O.getServiceStatus();e.success&&(T.value=e.data)}catch(e){console.error("è·å–æœåŠ¡çŠ¶æ€å¤±è´¥:",e)}},se=async()=>{try{const e=await O.getUnreadCount();e.success&&(I.value=e.data.unreadCount)}catch(e){console.error("è·å–æœªè¯»æ¶ˆæ¯æ•°é‡å¤±è´¥:",e)}},re=async()=>{try{const e=await O.markMessagesAsRead();e.success&&(I.value=e.data.unreadCount)}catch(e){console.error("æ ‡è®°æ¶ˆæ¯å·²è¯»å¤±è´¥:",e)}},E=()=>{X(()=>{H.value&&(H.value.scrollTop=H.value.scrollHeight)})},ne=e=>{var s,o,u,m,h,p;const t=(s=n.user)==null?void 0:s.id;if(e.message_type==="customer_service"||e.isAdmin){const $=e.senderId||((o=e.data)==null?void 0:o.userId)||((u=e.data)==null?void 0:u.senderId);if($)return $===t;const x=e.nickname||e.userName||((m=e.data)==null?void 0:m.userName),U=n.userDisplayName;if(x&&U)return x===U}return(e.user_id||((h=e.data)==null?void 0:h.user_id)||((p=e.data)==null?void 0:p.userId))===t},F=e=>{var t,r,s,o;return e.isAdmin===!0||e.message_type==="customer_service"||((t=e.data)==null?void 0:t.isAdmin)===!0||((r=e.data)==null?void 0:r.isCustomerService)===!0||((s=e.data)==null?void 0:s.role)==="admin"||((o=e.data)==null?void 0:o.role)==="customer_service"},K=e=>{if(!e)return"";const t=new Date(e),s=new Date-t,o=Math.floor(s/(1e3*60)),u=Math.floor(s/(1e3*60*60*24));return u===0?o<1?"åˆšåˆš":o<60?`${o}åˆ†é’Ÿå‰`:t.toLocaleTimeString("zh-CN",{hour12:!1,hour:"2-digit",minute:"2-digit"}):u===1?`æ˜¨å¤© ${t.toLocaleTimeString("zh-CN",{hour12:!1,hour:"2-digit",minute:"2-digit"})}`:u<7?`${["å‘¨æ—¥","å‘¨ä¸€","å‘¨äºŒ","å‘¨ä¸‰","å‘¨å››","å‘¨äº”","å‘¨å…­"][t.getDay()]} ${t.toLocaleTimeString("zh-CN",{hour12:!1,hour:"2-digit",minute:"2-digit"})}`:t.toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},Me=e=>{switch(e){case"active":return"bg-green-500/20 text-green-400 border-green-500/30";case"waiting":return"bg-yellow-500/20 text-yellow-400 border-yellow-500/30";case"closed":return"bg-gray-500/20 text-gray-400 border-gray-500/30";default:return"bg-gray-500/20 text-gray-400 border-gray-500/30"}},Ae=e=>{switch(e){case"active":return"è¿›è¡Œä¸­";case"waiting":return"ç­‰å¾…ä¸­";case"closed":return"å·²ç»“æŸ";default:return"æœªçŸ¥"}},oe=e=>{var r;const t=e.avatar||((r=e.data)==null?void 0:r.avatar);return t&&t.trim()&&t!=="null"&&t!=="undefined"?t.trim():null},Oe=e=>{var t,r;return e.nickname||((t=e.data)==null?void 0:t.nickname)||e.userName||((r=e.data)==null?void 0:r.userName)||"ç”¨æˆ·"},le=e=>{var r,s;const t=e.avatar||((r=e.data)==null?void 0:r.avatar)||((s=n.user)==null?void 0:s.avatar);return t&&t.trim()&&t!=="null"&&t!=="undefined"?t.trim():null},ie=e=>{var t,r;return e.nickname||((t=e.data)==null?void 0:t.nickname)||e.userName||((r=e.data)==null?void 0:r.userName)||n.userDisplayName},G=e=>{console.log("å¤´åƒåŠ è½½å¤±è´¥:",e.target.src),e.target.style.display="none"},ce=e=>{console.log("å¤´åƒåŠ è½½æˆåŠŸ:",e.target.src)},de=async()=>{if(I.value>0)try{(await O.markMessagesAsRead()).success&&(I.value=0,console.log("æ¶ˆæ¯å·²è‡ªåŠ¨æ ‡è®°ä¸ºå·²è¯»"))}catch(e){console.error("è‡ªåŠ¨æ ‡è®°æ¶ˆæ¯å·²è¯»å¤±è´¥:",e)}},$e=async e=>{console.log("é€‰ä¸­ç”¨æˆ·ä¼šè¯:",e),ee(),l.value=e,await We(e.user_id),e.unread_count>0&&(await Te(e.user_id),e.unread_count=0)},We=async e=>{try{console.log("åŠ è½½ç”¨æˆ·èŠå¤©è®°å½•:",e);const t=await O.getUserMessages(e,{limit:50});t.success&&t.data&&(w.value=t.data.map(r=>{console.log("ç”¨æˆ·æ¶ˆæ¯:",r);const s=r.message_type==="customer_service"||r.role==="admin"||r.role==="customer_service"||r.is_admin_message===1;return{...r,user_id:r.user_id||r.id,isAdmin:s,avatar:r.avatar,nickname:r.nickname||r.username,userName:r.nickname||r.username,message_type:s?"customer_service":"user"}}),console.log("ç”¨æˆ·èŠå¤©è®°å½•åŠ è½½å®Œæˆ:",w.value),E())}catch(t){console.error("åŠ è½½ç”¨æˆ·èŠå¤©è®°å½•å¤±è´¥:",t),await V()}},Te=async e=>{try{(await O.markSessionAsRead(e)).success&&(console.log("ä¼šè¯å·²æ ‡è®°ä¸ºå·²è¯»:",e),await se())}catch(t){console.error("æ ‡è®°ä¼šè¯å·²è¯»å¤±è´¥:",t),await de()}},ze=()=>{console.log("è¿”å›å®¢æœæ¨¡å¼"),ee(),l.value=null,V()},Ee=e=>{var s;const t=e.user_id,r=k.value.findIndex(o=>o.user_id===t);if(r>=0){const o=k.value[r];o.last_message=e.message||((s=e.data)==null?void 0:s.message),o.last_message_time=new Date().toISOString(),(!l.value||l.value.user_id!==t)&&e.message_type==="user"&&(o.unread_count=(o.unread_count||0)+1),k.value.splice(r,1),k.value.unshift(o)}else e.message_type==="user"&&z()};return Re(async()=>{if(!n.isLoggedIn){Pe("/auth/login");return}await Promise.all([je(),se(),V(),z()]),Y()}),Be(()=>{we()}),(e,t)=>{const r=Le;return d(),c("div",Ye,[t[27]||(t[27]=a("div",{class:"fixed inset-0 pointer-events-none"},[a("div",{class:"absolute top-20 left-20 w-96 h-96 bg-gradient-to-r from-cyan-500/20 to-blue-500/20 rounded-full filter blur-3xl animate-pulse"}),a("div",{class:"absolute bottom-20 right-20 w-80 h-80 bg-gradient-to-r from-purple-500/20 to-pink-500/20 rounded-full filter blur-3xl animate-pulse delay-1000"})],-1)),he(r,{"show-back-button":!1,"show-nav-menu":!0,"show-breadcrumb":!0,"show-location":!1,"show-search-button":!1,"show-notification-button":!0,"show-decorations":!1,"current-page-title":"åœ¨çº¿å®¢æœ","logo-size":"medium"}),a("section",Ze,[a("div",et,[a("div",tt,[a("div",at,[t[5]||(t[5]=a("div",null,[a("h1",{class:"text-4xl font-bold text-white mb-3 flex items-center gap-3"},[a("i",{class:"bi bi-headset text-cyan-400 text-3xl animate-bounce-gentle"}),N(" åœ¨çº¿å®¢æœ ")]),a("p",{class:"text-gray-300 text-lg"},"ä¸“ä¸šçš„å®¢æœå›¢é˜Ÿéšæ—¶ä¸ºæ‚¨æä¾›å¸®åŠ©")],-1)),a("div",st,[a("div",rt,[a("div",nt,[a("div",{class:f(["w-3 h-3 rounded-full animate-pulse",T.value.adminOnline?"bg-green-500":"bg-red-500"])},null,2),a("span",ot,v(T.value.adminOnline?"å®¢æœåœ¨çº¿":"æš‚æ— å®¢æœåœ¨çº¿"),1)])]),a("div",lt,[I.value>0?(d(),c("button",{key:0,onClick:re,class:"px-4 py-2 text-sm font-medium bg-cyan-600 hover:bg-cyan-500 text-white rounded-lg transition-all duration-300 flex items-center gap-2 hover:scale-105 active:scale-95"},[t[3]||(t[3]=a("i",{class:"bi bi-check2-all"},null,-1)),N(" æ ‡è®°å·²è¯» ("+v(I.value)+") ",1)])):_("",!0),a("button",{onClick:z,class:"px-4 py-2 text-sm font-medium border border-gray-600 hover:border-cyan-500 text-gray-300 hover:text-white rounded-lg transition-all duration-300 flex items-center gap-2 hover:scale-105 active:scale-95"},t[4]||(t[4]=[a("i",{class:"bi bi-arrow-clockwise"},null,-1),N(" åˆ·æ–° ")]))])])])])])]),a("section",it,[a("div",ct,[a("div",dt,[a("div",ut,[a("div",vt,[a("div",mt,[t[6]||(t[6]=a("i",{class:"bi bi-chat-dots text-cyan-400"},null,-1)),t[7]||(t[7]=a("span",{class:"text-white font-medium"},"å½“å‰æ¨¡å¼ï¼š",-1)),a("span",yt,v(l.value?`ä¸ ${l.value.user_nickname||l.value.user_name||"ç”¨æˆ·"} å¯¹è¯`:"å®¢æœå›¢é˜Ÿæ¨¡å¼"),1)]),l.value?(d(),c("div",gt,t[8]||(t[8]=[a("div",{class:"w-2 h-2 rounded-full bg-green-500 animate-pulse"},null,-1),a("span",{class:"text-sm text-gray-400"},"ç”¨æˆ·å¯¹è¯ä¸­",-1)]))):_("",!0)]),a("div",ft,[a("div",ht,[t[9]||(t[9]=a("i",{class:"bi bi-people"},null,-1)),a("span",null,"ä¼šè¯: "+v(k.value.length),1)]),a("div",xt,[t[10]||(t[10]=a("i",{class:"bi bi-chat-left-dots"},null,-1)),a("span",null,"æ¶ˆæ¯: "+v(w.value.length),1)]),a("div",pt,[a("div",{class:f(["w-2 h-2 rounded-full animate-pulse",i.value?"bg-green-500":"bg-red-500"])},null,2),a("span",_t,v(i.value?"å·²è¿æ¥":"è¿æ¥ä¸­..."),1)])])])])])]),a("main",bt,[a("div",wt,[a("div",kt,[a("div",St,[a("div",Ct,[a("div",Nt,[a("div",null,[t[11]||(t[11]=a("h3",{class:"text-lg font-semibold text-white mb-1 flex items-center gap-2"},[a("i",{class:"bi bi-chat-left-text text-cyan-400"}),N(" å¯¹è¯åˆ—è¡¨ ")],-1)),a("p",It,[N(v(k.value.length)+" ä¸ªä¼šè¯ ",1),l.value?(d(),c("span",Ut," Â· å·²é€‰ä¸­ "+v(l.value.user_nickname||l.value.user_name||`ç”¨æˆ·
                      #${l.value.user_id}`),1)):_("",!0)])]),a("div",jt,[l.value?(d(),c("button",{key:0,onClick:ze,class:"p-2 text-gray-400 hover:text-cyan-300 hover:bg-gray-700/50 rounded-lg transition-all duration-300 hover:scale-110 active:scale-95",title:"è¿”å›å®¢æœæ¨¡å¼"},t[12]||(t[12]=[a("i",{class:"bi bi-arrow-left text-lg"},null,-1)]))):_("",!0),a("button",{onClick:z,class:"p-2 text-gray-400 hover:text-cyan-300 hover:bg-gray-700/50 rounded-lg transition-all duration-300 hover:scale-110 active:scale-95",title:"åˆ·æ–°åˆ—è¡¨"},t[13]||(t[13]=[a("i",{class:"bi bi-arrow-clockwise text-lg"},null,-1)]))])])]),a("div",Mt,[k.value.length===0?(d(),c("div",At,t[14]||(t[14]=[a("div",{class:"w-20 h-20 bg-gradient-to-br from-gray-700/50 to-gray-800/50 rounded-full flex items-center justify-center mb-6"},[a("i",{class:"bi bi-chat-dots text-3xl text-gray-500"})],-1),a("h4",{class:"text-xl font-semibold text-white mb-3"},"æš‚æ— å¯¹è¯",-1),a("p",{class:"text-gray-400 text-sm leading-relaxed"},[N("ç­‰å¾…ç”¨æˆ·å¼€å§‹å¯¹è¯"),a("br"),N("æˆ–ä»å®¢æœå›¢é˜Ÿæ¨¡å¼å¼€å§‹")],-1)]))):(d(),c("div",Ot,[(d(!0),c(L,null,D(k.value,(s,o)=>{var u,m,h;return d(),c("div",{key:s.id,onClick:p=>$e(s),class:f(["relative p-4 rounded-xl cursor-pointer transition-all duration-300 group hover:scale-[1.01] animate-fade-in-up border border-transparent hover:border-gray-600/50",[((u=l.value)==null?void 0:u.id)===s.id?"session-selected border-cyan-500/50":"hover:bg-gray-800/30"]]),style:xe({animationDelay:`${o*50}ms`})},[((m=l.value)==null?void 0:m.id)===s.id?(d(),c("div",Wt)):_("",!0),s.unread_count>0?(d(),c("div",Tt,[a("span",zt,v(s.unread_count>99?"99+":s.unread_count),1)])):_("",!0),a("div",Et,[a("div",Lt,[a("div",{class:f(["w-14 h-14 rounded-xl overflow-hidden border-2 transition-all duration-300 shadow-lg",((h=l.value)==null?void 0:h.id)===s.id?"border-cyan-400/70 shadow-cyan-400/20":"border-gray-700/50"])},[s.user_avatar?(d(),c("img",{key:0,src:s.user_avatar,alt:s.user_nickname||"ç”¨æˆ·",class:"w-full h-full object-cover",onError:t[0]||(t[0]=p=>p.target.style.display="none")},null,40,Dt)):(d(),c("div",Ht,t[15]||(t[15]=[a("i",{class:"bi bi-person text-white text-xl"},null,-1)])))],2),a("div",Rt,[a("div",{class:f(["w-3 h-3 rounded-full",s.isOnline?"bg-green-500 animate-pulse":"bg-gray-500"])},null,2)])]),a("div",Pt,[a("div",Bt,[a("h4",Ft,v(s.user_nickname||s.user_name||`ç”¨æˆ· #${s.user_id}`),1),a("span",Jt,v(K(s.last_message_time||s.started_at)),1)]),a("div",Vt,[a("p",Kt,v(s.last_message||"ç­‰å¾…å¼€å§‹å¯¹è¯..."),1)]),a("div",Gt,[a("div",qt,[a("span",{class:f(["text-xs px-2 py-1 rounded-lg font-medium",Me(s.status)])},v(Ae(s.status)),3),s.rating?(d(),c("div",Qt,[a("div",Xt,[(d(),c(L,null,D(5,p=>a("i",{key:p,class:f([p<=s.rating?"text-yellow-400":"text-gray-600","bi bi-star-fill text-xs"])},null,2)),64))]),a("span",Yt,v(s.rating)+".0",1)])):_("",!0)]),a("div",Zt,[a("div",{class:f(["w-2 h-2 rounded-full",s.isOnline?"bg-green-500 animate-pulse":"bg-gray-500"])},null,2),a("span",{class:f(["text-xs",s.isOnline?"text-green-400":"text-gray-400"])},v(s.isOnline?"åœ¨çº¿":"ç¦»çº¿"),3)])])])])],14,$t)}),128))]))])])]),a("div",ea,[a("div",ta,[a("div",aa,[a("div",sa,[a("div",ra,[a("div",{class:f(["w-12 h-12 rounded-xl flex items-center justify-center overflow-hidden border-2 shadow-lg transition-all duration-300",S.value.isCustomerService?"border-cyan-500/50":"border-gray-600/50"])},[S.value.avatar?(d(),c("img",{key:0,src:S.value.avatar,alt:S.value.name,class:"w-full h-full object-cover",onError:G},null,40,na)):(d(),c("div",{key:1,class:f(["w-full h-full flex items-center justify-center animate-pulse-gentle",S.value.isCustomerService?"bg-gradient-to-r from-cyan-500 to-blue-500":"bg-gradient-to-r from-gray-500 to-gray-600"])},[a("i",{class:f(["text-white text-xl",S.value.isCustomerService?"bi bi-headset":"bi bi-person"])},null,2)],2))],2),a("div",null,[a("h3",oa,[N(v(S.value.name)+" ",1),S.value.isCustomerService?(d(),c("i",la)):_("",!0)]),a("p",ia,[a("div",{class:f(["w-2 h-2 rounded-full",S.value.isCustomerService?i.value?"bg-green-500 animate-pulse":"bg-gray-500":S.value.isOnline?"bg-green-500 animate-pulse":"bg-gray-500"])},null,2),N(" "+v(S.value.status),1)])])]),a("div",ca,[a("div",da,[a("div",{class:f(["w-2 h-2 rounded-full animate-pulse",i.value?"bg-green-500":"bg-red-500"])},null,2),a("span",ua,v(i.value?"å·²è¿æ¥":"è¿æ¥ä¸­..."),1)]),t[16]||(t[16]=Q('<div class="flex items-center gap-1" data-v-1dfbc53a><button class="p-2 text-gray-400 hover:text-white hover:bg-gray-700/50 rounded-lg transition-all duration-300 hover:scale-110 active:scale-95" title="è¯­éŸ³é€šè¯" data-v-1dfbc53a><i class="bi bi-telephone text-lg" data-v-1dfbc53a></i></button><button class="p-2 text-gray-400 hover:text-white hover:bg-gray-700/50 rounded-lg transition-all duration-300 hover:scale-110 active:scale-95" title="æ›´å¤šé€‰é¡¹" data-v-1dfbc53a><i class="bi bi-three-dots text-lg" data-v-1dfbc53a></i></button></div>',1))])])]),a("div",{class:"flex-1 overflow-y-auto p-6",ref_key:"messagesContainer",ref:H},[w.value.length===0?(d(),c("div",va,[t[17]||(t[17]=a("div",{class:"w-24 h-24 bg-gradient-to-r from-cyan-500/20 to-blue-500/20 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-2xl"},[a("i",{class:"bi bi-chat-heart text-4xl text-cyan-400"})],-1)),a("h3",ma,v(l.value?`ä¸ ${l.value.user_nickname||l.value.user_name||`ç”¨æˆ·
                  #${l.value.user_id}`} çš„å¯¹è¯`:"æ¬¢è¿ä½¿ç”¨åœ¨çº¿å®¢æœ"),1),a("p",ya,v(l.value?"æ‚¨æ­£åœ¨ä¸è¯¥ç”¨æˆ·è¿›è¡Œç§äººå¯¹è¯ï¼Œå¯ä»¥å®æ—¶äº¤æµè§£å†³é—®é¢˜":"æœ‰ä»»ä½•é—®é¢˜éƒ½å¯ä»¥åœ¨è¿™é‡Œä¸æˆ‘ä»¬æ²Ÿé€šï¼Œæ‚¨ä¹Ÿå¯ä»¥ä»å·¦ä¾§é€‰æ‹©ç‰¹å®šç”¨æˆ·è¿›è¡Œå¯¹è¯"),1),a("div",ga,[(d(),c(L,null,D(_e,(s,o)=>a("button",{key:s,onClick:u=>Ne(s),class:"px-6 py-3 bg-cyan-500/20 border border-cyan-400/30 text-cyan-300 rounded-xl text-sm font-medium hover:bg-cyan-500/30 hover:border-cyan-400/50 transition-all duration-300 hover:scale-105 active:scale-95 animate-fade-in-up shadow-lg hover:shadow-cyan-400/20",style:xe({animationDelay:`${o*100}ms`})},v(s),13,fa)),64))])])):_("",!0),!T.value.adminOnline&&w.value.length>0?(d(),c("div",ha,t[18]||(t[18]=[a("div",{class:"bg-yellow-500/10 border border-yellow-400/30 rounded-lg p-4 text-center transition-all duration-300 hover:bg-yellow-500/15 hover:border-yellow-400/50"},[a("i",{class:"bi bi-info-circle text-yellow-400 mr-2 animate-pulse"}),a("span",{class:"text-yellow-300 text-sm"},"å½“å‰æš‚æ— å®¢æœåœ¨çº¿ï¼Œæ‚¨å¯ä»¥ç•™è¨€ï¼Œæˆ‘ä»¬ä¼šå°½å¿«å›å¤æ‚¨ã€‚")],-1)]))):_("",!0),a("div",xa,[he(Je,{name:"message",tag:"div",class:"space-y-4"},{default:Fe(()=>[(d(!0),c(L,null,D(w.value,s=>{var o,u,m;return d(),c("div",{key:s.id||s.timestamp,class:f(["flex",ne(s)?"justify-end":"justify-start"])},[ne(s)?(d(),c("div",Ca,[a("div",Na,[le(s)?(d(),c("img",{key:0,src:le(s),alt:ie(s),class:"w-full h-full object-cover",onError:G,onLoad:ce},null,40,Ia)):(d(),c("div",Ua,t[19]||(t[19]=[a("i",{class:"bi bi-person text-white text-sm"},null,-1)])))]),a("div",ja,[a("div",Ma,v(s.message||((m=s.data)==null?void 0:m.message)),1),a("div",Aa,[a("span",Oa,v(K(s.timestamp||s.created_at)),1),a("span",$a,v(ie(s)),1)])])])):(d(),c("div",pa,[a("div",_a,[oe(s)?(d(),c("img",{key:0,src:oe(s),alt:Oe(s),class:"w-full h-full object-cover",onError:G,onLoad:ce},null,40,ba)):(d(),c("div",{key:1,class:f(["w-full h-full rounded-full flex items-center justify-center",F(s)?"bg-gradient-to-r from-green-500 to-emerald-500":"bg-gradient-to-r from-gray-500 to-gray-600"])},[a("i",{class:f(["text-white text-sm",F(s)?"bi bi-person-badge":"bi bi-person"])},null,2)],2))]),a("div",null,[a("div",wa,v(s.message||((o=s.data)==null?void 0:o.message)),1),a("div",ka,[a("span",{class:f(["text-xs",F(s)?"text-green-400":"text-gray-400"])},v(s.nickname||((u=s.data)==null?void 0:u.nickname)||(F(s)?"å®¢æœ":"ç”¨æˆ·")),3),a("span",Sa,v(K(s.timestamp||s.created_at)),1)])])]))],2)}),128))]),_:1}),g.value&&j.value.size>0?(d(),c("div",Wa,[(d(!0),c(L,null,D(j.value,([s,o])=>(d(),c("div",{key:s,class:"flex items-start gap-3 max-w-[70%] animate-fade-in-up mb-2"},[a("div",Ta,[o.avatar?(d(),c("img",{key:0,src:o.avatar,alt:o.nickname,class:"w-full h-full object-cover",onError:t[1]||(t[1]=u=>u.target.style.display="none")},null,40,za)):(d(),c("div",Ea,t[20]||(t[20]=[a("i",{class:"bi bi-person-badge text-white text-sm"},null,-1)])))]),a("div",null,[t[22]||(t[22]=Q('<div class="bg-gray-700/50 border border-gray-600/30 rounded-2xl rounded-tl-sm p-3" data-v-1dfbc53a><div class="flex gap-1" data-v-1dfbc53a><div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" data-v-1dfbc53a></div><div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay:0.1s;" data-v-1dfbc53a></div><div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay:0.2s;" data-v-1dfbc53a></div></div></div>',1)),a("div",La,[a("span",Da,v(o.nickname),1),t[21]||(t[21]=a("span",{class:"text-xs text-gray-500"},"æ­£åœ¨è¾“å…¥...",-1))])])]))),128))])):_("",!0)])],512),a("div",Ha,[a("div",Ra,[t[25]||(t[25]=Q('<div class="flex items-center gap-2" data-v-1dfbc53a><button class="p-2 text-gray-400 hover:text-white hover:bg-gray-700/50 rounded-lg transition-all duration-300 hover:scale-110 active:scale-95" title="é™„ä»¶" data-v-1dfbc53a><i class="bi bi-paperclip text-lg" data-v-1dfbc53a></i></button><button class="p-2 text-gray-400 hover:text-white hover:bg-gray-700/50 rounded-lg transition-all duration-300 hover:scale-110 active:scale-95" title="è¡¨æƒ…" data-v-1dfbc53a><i class="bi bi-emoji-smile text-lg" data-v-1dfbc53a></i></button></div>',1)),a("div",Pa,[t[24]||(t[24]=a("span",{class:"text-xs text-gray-500 flex items-center gap-1"},[a("i",{class:"bi bi-keyboard"}),N(" Enter å‘é€ï¼ŒShift+Enter æ¢è¡Œ ")],-1)),M.value.length>0?(d(),c("div",Ba,v(M.value.length)+" å­—ç¬¦ ",1)):_("",!0),I.value>0?(d(),c("button",{key:1,onClick:re,class:"text-xs text-cyan-400 hover:text-cyan-300 transition-all duration-300 hover:scale-105 active:scale-95 px-3 py-1 rounded-lg hover:bg-cyan-500/10 border border-cyan-500/20"},[t[23]||(t[23]=a("i",{class:"bi bi-check2-all mr-1"},null,-1)),N(" æ ‡è®°å·²è¯» ("+v(I.value)+") ",1)])):_("",!0)])]),a("div",Fa,[a("div",Ja,[Ve(a("textarea",{"onUpdate:modelValue":t[2]||(t[2]=s=>M.value=s),onKeydown:Ge(qe(J,["exact","prevent"]),["enter"]),onInput:Ce,onFocus:Ie,onBlur:Ue,disabled:!i.value,placeholder:"è¾“å…¥æ‚¨çš„æ¶ˆæ¯... (Enter å‘é€ï¼ŒShift+Enter æ¢è¡Œ)",rows:"1",class:"w-full px-4 py-3 bg-gray-800/50 border border-gray-600/50 rounded-xl focus:ring-2 focus:ring-cyan-500 focus:border-cyan-400 text-white placeholder-gray-400 transition-all duration-300 resize-none hover:border-cyan-500/50 focus:scale-[1.01] min-h-[48px] max-h-32 hide-scrollbar"},null,40,Va),[[Ke,M.value]]),B.value?(d(),c("div",Ka," æ­£åœ¨è¾“å…¥... ")):_("",!0)]),a("button",{onClick:J,disabled:!M.value.trim()||!i.value,class:"px-6 py-3 bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 disabled:from-gray-600 disabled:to-gray-700 text-white font-semibold rounded-xl transition-all duration-300 shadow-lg shadow-cyan-500/20 hover:shadow-cyan-500/40 disabled:shadow-none flex items-center gap-2 hover:scale-105 active:scale-95 min-h-[48px] flex-shrink-0"},t[26]||(t[26]=[a("i",{class:"bi bi-send text-lg"},null,-1),a("span",{class:"hidden sm:inline"},"å‘é€",-1)]),8,Ga)])])])])])])])}}},rs=De(qa,[["__scopeId","data-v-1dfbc53a"]]);export{rs as default};
