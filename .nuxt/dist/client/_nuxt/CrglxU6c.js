import{_ as he}from"./kALhssUB.js";import{_ as we}from"./BMTFDIi_.js";import{s as ke,x as _e,r as f,y as ee,g as Pe,o as n,w as Ce,a as e,b as Ue,c as l,i as y,d as u,m as o,t as i,k as U,F as Fe,j as je,z as se,p as g,v as x}from"./D6E0p70F.js";import{u as Ae,p as Ve}from"./CEhNW_6w.js";import{api as V,uploadApi as P}from"./B6kMf_YV.js";import{c as Le}from"./9bKZ-qGF.js";import{_ as Ee}from"./DlAUqK2U.js";import"./XT9ipho2.js";import"./DxXK6IxH.js";import"./BDACH_0w.js";import"./BmC-42n3.js";import"./COWn9IxZ.js";import"./CDQxMkrZ.js";import"./CZRRUHTJ.js";import"./BRMC2c8x.js";const ze={class:"min-h-screen bg-gradient-to-br from-gray-900 via-slate-900 to-black relative overflow-hidden"},Be={class:"relative z-10 py-8"},Ie={class:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8"},Me={class:"glass-card-dark rounded-2xl p-8 border border-cyan-500/30 shadow-2xl shadow-cyan-500/20 mb-6 animate-fade-in-up animation-delay-200"},Se={class:"flex items-center space-x-6"},Ne={class:"relative group"},qe={class:"w-24 h-24 rounded-full bg-gradient-to-r from-cyan-500 to-blue-500 flex items-center justify-center text-white text-2xl font-bold shadow-lg shadow-cyan-500/20 group-hover:shadow-cyan-500/40 transition-all duration-300 transform group-hover:scale-105 overflow-hidden"},$e=["src","alt"],De={key:1},Ge={class:"flex-1"},Re={class:"text-2xl font-bold text-white mb-2"},Te={class:"text-gray-300 mb-1"},He={key:0,class:"text-sm text-gray-400"},Je={class:"flex items-center space-x-4 mt-3"},Ke={class:"flex flex-col space-y-3"},We={class:"glass-card-dark rounded-2xl border border-cyan-500/30 shadow-2xl shadow-cyan-500/20 overflow-hidden animate-fade-in-up animation-delay-400"},Oe={class:"border-b border-gray-700/50"},Qe={class:"flex space-x-8"},Xe=["onClick"],Ye={class:"p-8"},Ze={key:0,class:"space-y-6 animate-fade-in"},es={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ss={class:"glass-morphism-dark rounded-lg p-4 border border-gray-700/50 hover:border-cyan-500/30 transition-all duration-300"},ts={class:"text-white text-lg"},as={class:"glass-morphism-dark rounded-lg p-4 border border-gray-700/50 hover:border-cyan-500/30 transition-all duration-300"},os={class:"text-white text-lg"},rs={class:"glass-morphism-dark rounded-lg p-4 border border-gray-700/50 hover:border-cyan-500/30 transition-all duration-300"},ns={class:"text-white text-lg"},ls={class:"glass-morphism-dark rounded-lg p-4 border border-gray-700/50 hover:border-cyan-500/30 transition-all duration-300"},is={class:"text-white text-lg"},ds={class:"glass-morphism-dark rounded-lg p-4 border border-gray-700/50 hover:border-cyan-500/30 transition-all duration-300 md:col-span-2"},cs={class:"text-white text-lg"},us={key:1,class:"space-y-6 animate-fade-in"},ms={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ps={class:"space-y-2"},bs={class:"space-y-2"},fs={class:"space-y-2 md:col-span-2"},ys={class:"flex justify-end space-x-4 mt-8"},vs=["disabled"],gs={key:0,class:"loading loading-spinner loading-sm mr-2"},xs={key:1,class:"bi bi-check-circle mr-2"},hs={key:2,class:"space-y-6 animate-fade-in"},ws={class:"max-w-md space-y-6"},ks={class:"space-y-2"},_s={class:"space-y-2"},Ps={class:"space-y-2"},Cs={class:"flex justify-end space-x-4 mt-8"},Us=["disabled"],Fs={key:0,class:"loading loading-spinner loading-sm mr-2"},js={key:1,class:"bi bi-shield-check mr-2"},As={key:0,class:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 animate-fade-in"},Vs={class:"glass-card-dark rounded-2xl p-6 max-w-md w-full mx-4 border border-cyan-500/30 shadow-2xl shadow-cyan-500/20 animate-scale-in"},Ls={class:"space-y-6"},Es={class:"flex justify-center"},zs={class:"relative"},Bs=["src"],Is={key:1,class:"text-center"},Ms={key:0,class:"text-center"},Ss={class:"text-sm text-gray-400"},Ns={class:"text-xs text-gray-500"},qs={class:"flex justify-end space-x-4"},$s=["disabled"],Ds={key:0,class:"loading loading-spinner loading-sm mr-2"},Gs={key:1,class:"bi bi-check-circle mr-2"},Rs=ke({__name:"profile",setup(Ts){var I;const a=_e(),{message:L}=Le(["message"]),F=t=>{L.success(t,{duration:3e3})},j=t=>{L.error(t,{duration:4e3})},h=f(!1),w=f(!1),A=f(!1),k=f(!1),b=f(null),m=f(null),p=f("info"),te=async()=>{try{const t=await V.auth.getProfile();return t.data?(a.updateUser(t.data),d.username=t.data.username,d.nickname=t.data.nickname||"",d.phone=t.data.phone||"",t.data):null}catch(t){throw console.error("获取用户信息失败:",t),new Error("获取用户信息失败")}},{isPageLoading:ae,isDataLoading:oe,hasError:re,errorMessage:ne,reloadPage:le}=Ae({...Ve.fast,cacheKey:`profile-${((I=a.user)==null?void 0:I.id)||"default"}`,loadFunction:te,onPageReady:t=>{t&&(a.updateUser(t),d.username=t.username,d.nickname=t.nickname||"",d.phone=t.phone||"")}}),ie=[{key:"info",label:"基本信息",icon:"bi bi-person"},{key:"edit",label:"编辑资料",icon:"bi bi-pencil-square"},{key:"password",label:"修改密码",icon:"bi bi-shield-lock"}],d=ee({username:"",nickname:"",phone:""}),c=ee({currentPassword:"",newPassword:"",confirmPassword:""}),de={user:"bg-blue-500/20 text-blue-300 border border-blue-500/30",merchant:"bg-purple-500/20 text-purple-300 border border-purple-500/30",admin:"bg-red-500/20 text-red-300 border border-red-500/30"},ce={user:"普通用户",merchant:"商家",admin:"管理员"},ue={active:"bg-green-500/20 text-green-300 border border-green-500/30",inactive:"bg-gray-500/20 text-gray-300 border border-gray-500/30",banned:"bg-red-500/20 text-red-300 border border-red-500/30"},me={active:"正常",inactive:"未激活",banned:"已封禁"},pe=async()=>{try{h.value=!0;const t=await V.auth.updateProfile(d);t.data&&(a.updateUser(t.data),F("个人信息更新成功！"),p.value="info")}catch(t){console.error("更新个人信息失败:",t),t(t.message||"更新失败，请重试")}finally{h.value=!1}},be=async()=>{if(c.newPassword!==c.confirmPassword){j("两次输入的密码不一致");return}try{w.value=!0,(await V.auth.changePassword({currentPassword:c.currentPassword,newPassword:c.newPassword})).success&&(F("密码修改成功！"),E(),p.value="info")}catch(t){console.error("修改密码失败:",t),t(t.message||"修改密码失败，请重试")}finally{w.value=!1}},fe=()=>{a.user&&(d.username=a.user.username,d.nickname=a.user.nickname||"",d.phone=a.user.phone||"")},E=()=>{c.currentPassword="",c.newPassword="",c.confirmPassword=""},z=()=>{var t;(t=document.getElementById("avatar-input"))==null||t.click()},ye=t=>{var C;const v=(C=t.target.files)==null?void 0:C[0];if(v){const _=P.validateImageFile(v);if(!_.valid){j(_.message||"文件格式不支持");return}m.value=v,b.value=P.getFilePreviewUrl(v)}},ve=async()=>{if(m.value)try{k.value=!0;const t=P.validateImageFile(m.value);if(!t.valid){j(t.message||"文件验证失败");return}const s=await P.uploadAvatar(m.value);if(s.success&&s.data)a.updateUser(s.data.user),F("头像上传成功！"),B();else throw new Error(s.message||"上传失败")}catch(t){console.error("上传头像失败:",t),t(t.message||"上传失败，请重试")}finally{k.value=!1}},B=()=>{A.value=!1,m.value=null,b.value&&(P.releaseFilePreviewUrl(b.value),b.value=null)},ge=t=>{console.log("头像加载失败，使用默认头像");const s=t.target;s.style.display="none"},xe=t=>t?new Date(t).toLocaleDateString("zh-CN"):"";return(t,s)=>{const v=he,C=we;return n(),Pe(C,{"is-page-loading":o(ae),"is-data-loading":o(oe),"has-error":o(re),"error-message":o(ne),"loading-title":"正在加载用户信息...","loading-message":"请稍候",onRetry:o(le)},{default:Ce(()=>{var _,M,S,N,q,$,D,G,R,T,H,J,K,W,O,Q,X,Y,Z;return[e("div",ze,[s[31]||(s[31]=e("div",{class:"fixed inset-0 pointer-events-none"},[e("div",{class:"absolute top-20 left-20 w-96 h-96 bg-gradient-to-r from-cyan-500/20 to-blue-500/20 rounded-full filter blur-3xl animate-pulse"}),e("div",{class:"absolute bottom-20 right-20 w-80 h-80 bg-gradient-to-r from-purple-500/20 to-pink-500/20 rounded-full filter blur-3xl animate-pulse delay-1000"})],-1)),Ue(v,{"show-back-button":!1,"show-nav-menu":!1,"show-breadcrumb":!0,"show-location":!1,"show-search-button":!1,"show-notification-button":!1,"show-decorations":!1,"logo-size":"medium","current-page-title":"个人中心"}),e("div",Be,[e("div",Ie,[s[25]||(s[25]=e("div",{class:"mb-8 animate-fade-in-up"},[e("div",{class:"glass-card-dark rounded-2xl p-8 border border-cyan-500/30 shadow-2xl shadow-cyan-500/20"},[e("h1",{class:"text-4xl font-bold text-white mb-3 flex items-center gap-3"},[e("i",{class:"bi bi-person-circle text-cyan-400 text-3xl animate-bounce-gentle"}),u(" 个人中心 ")]),e("p",{class:"text-gray-300 text-lg"},"管理您的个人信息和账户设置")])],-1)),e("div",Me,[e("div",Se,[e("div",Ne,[e("div",qe,[(_=o(a).user)!=null&&_.avatar?(n(),l("img",{key:0,src:o(a).user.avatar,alt:(((M=o(a).user)==null?void 0:M.nickname)||((S=o(a).user)==null?void 0:S.username)||"U")+"的头像",class:"w-full h-full object-cover",onError:ge},null,40,$e)):(n(),l("span",De,i((((N=o(a).user)==null?void 0:N.nickname)||((q=o(a).user)==null?void 0:q.username)||"U").charAt(0).toUpperCase()),1))]),e("button",{onClick:s[0]||(s[0]=r=>A.value=!0),class:"absolute bottom-0 right-0 bg-cyan-500 text-white rounded-full p-2 hover:bg-cyan-400 transition-all duration-200 transform hover:scale-110 shadow-lg shadow-cyan-500/20"},s[9]||(s[9]=[e("i",{class:"bi bi-camera text-sm"},null,-1)]))]),e("div",Ge,[e("h2",Re,i((($=o(a).user)==null?void 0:$.nickname)||((D=o(a).user)==null?void 0:D.username)||"加载中..."),1),e("p",Te,i(((G=o(a).user)==null?void 0:G.email)||""),1),(R=o(a).user)!=null&&R.nickname&&((T=o(a).user)!=null&&T.username)?(n(),l("p",He,"用户名: "+i(o(a).user.username),1)):y("",!0),e("div",Je,[e("span",{class:U(["inline-flex items-center px-3 py-1 rounded-full text-xs font-medium",de[((H=o(a).user)==null?void 0:H.role)||"user"]])},i(ce[((J=o(a).user)==null?void 0:J.role)||"user"]),3),e("span",{class:U(["inline-flex items-center px-3 py-1 rounded-full text-xs font-medium",ue[((K=o(a).user)==null?void 0:K.status)||"active"]])},i(me[((W=o(a).user)==null?void 0:W.status)||"active"]),3)])]),e("div",Ke,[e("button",{onClick:s[1]||(s[1]=r=>p.value="edit"),class:"btn-premium-dark px-6 py-3 rounded-lg font-medium transition-all duration-300 transform hover:-translate-y-1"},s[10]||(s[10]=[e("i",{class:"bi bi-pencil-square mr-2"},null,-1),u(" 编辑资料 ")])),e("button",{onClick:s[2]||(s[2]=r=>p.value="password"),class:"btn-outline-dark px-6 py-3 rounded-lg font-medium transition-all duration-300 transform hover:-translate-y-1"},s[11]||(s[11]=[e("i",{class:"bi bi-shield-lock mr-2"},null,-1),u(" 修改密码 ")]))])])]),e("div",We,[e("div",Oe,[e("nav",Qe,[(n(),l(Fe,null,je(ie,r=>e("button",{key:r.key,onClick:Hs=>p.value=r.key,class:U(["py-3 px-6 text-sm font-medium border-b-2 transition-all duration-300 flex items-center gap-2",p.value===r.key?"border-cyan-500 text-cyan-400 bg-cyan-500/10":"border-transparent text-gray-400 hover:text-white hover:border-gray-500"])},[e("i",{class:U(r.icon)},null,2),u(" "+i(r.label),1)],10,Xe)),64))])]),e("div",Ye,[p.value==="info"?(n(),l("div",Ze,[e("div",es,[e("div",ss,[s[12]||(s[12]=e("label",{class:"block text-sm font-medium text-cyan-400 mb-2"},"用户名",-1)),e("p",ts,i(((O=o(a).user)==null?void 0:O.username)||"-"),1)]),e("div",as,[s[13]||(s[13]=e("label",{class:"block text-sm font-medium text-cyan-400 mb-2"},"昵称",-1)),e("p",os,i(((Q=o(a).user)==null?void 0:Q.nickname)||"-"),1)]),e("div",rs,[s[14]||(s[14]=e("label",{class:"block text-sm font-medium text-cyan-400 mb-2"},"邮箱",-1)),e("p",ns,i(((X=o(a).user)==null?void 0:X.email)||"-"),1)]),e("div",ls,[s[15]||(s[15]=e("label",{class:"block text-sm font-medium text-cyan-400 mb-2"},"手机号",-1)),e("p",is,i(((Y=o(a).user)==null?void 0:Y.phone)||"-"),1)]),e("div",ds,[s[16]||(s[16]=e("label",{class:"block text-sm font-medium text-cyan-400 mb-2"},"注册时间",-1)),e("p",cs,i(xe((Z=o(a).user)==null?void 0:Z.created_at)||"-"),1)])])])):y("",!0),p.value==="edit"?(n(),l("div",us,[e("form",{onSubmit:se(pe,["prevent"])},[e("div",ms,[e("div",ps,[s[17]||(s[17]=e("label",{for:"username",class:"block text-sm font-medium text-cyan-400"},"用户名",-1)),g(e("input",{id:"username","onUpdate:modelValue":s[3]||(s[3]=r=>d.username=r),type:"text",class:"input-dark w-full",placeholder:"请输入用户名"},null,512),[[x,d.username]])]),e("div",bs,[s[18]||(s[18]=e("label",{for:"nickname",class:"block text-sm font-medium text-cyan-400"},"昵称",-1)),g(e("input",{id:"nickname","onUpdate:modelValue":s[4]||(s[4]=r=>d.nickname=r),type:"text",class:"input-dark w-full",placeholder:"请输入昵称"},null,512),[[x,d.nickname]])]),e("div",fs,[s[19]||(s[19]=e("label",{for:"phone",class:"block text-sm font-medium text-cyan-400"},"手机号",-1)),g(e("input",{id:"phone","onUpdate:modelValue":s[5]||(s[5]=r=>d.phone=r),type:"tel",class:"input-dark w-full",placeholder:"请输入手机号"},null,512),[[x,d.phone]])])]),e("div",ys,[e("button",{type:"button",onClick:fe,class:"btn-outline-dark px-6 py-3 rounded-lg font-medium transition-all duration-300 transform hover:-translate-y-1"},s[20]||(s[20]=[e("i",{class:"bi bi-arrow-clockwise mr-2"},null,-1),u(" 重置 ")])),e("button",{type:"submit",disabled:h.value,class:"btn-premium-dark px-6 py-3 rounded-lg font-medium transition-all duration-300 transform hover:-translate-y-1 disabled:opacity-50 disabled:cursor-not-allowed"},[h.value?(n(),l("span",gs)):(n(),l("i",xs)),u(" "+i(h.value?"保存中...":"保存修改"),1)],8,vs)])],32)])):y("",!0),p.value==="password"?(n(),l("div",hs,[e("form",{onSubmit:se(be,["prevent"])},[e("div",ws,[e("div",ks,[s[21]||(s[21]=e("label",{for:"currentPassword",class:"block text-sm font-medium text-cyan-400"},"当前密码",-1)),g(e("input",{id:"currentPassword","onUpdate:modelValue":s[6]||(s[6]=r=>c.currentPassword=r),type:"password",class:"input-dark w-full",placeholder:"请输入当前密码",required:""},null,512),[[x,c.currentPassword]])]),e("div",_s,[s[22]||(s[22]=e("label",{for:"newPassword",class:"block text-sm font-medium text-cyan-400"},"新密码",-1)),g(e("input",{id:"newPassword","onUpdate:modelValue":s[7]||(s[7]=r=>c.newPassword=r),type:"password",class:"input-dark w-full",placeholder:"请输入新密码（至少6位）",required:"",minlength:"6"},null,512),[[x,c.newPassword]])]),e("div",Ps,[s[23]||(s[23]=e("label",{for:"confirmPassword",class:"block text-sm font-medium text-cyan-400"},"确认新密码",-1)),g(e("input",{id:"confirmPassword","onUpdate:modelValue":s[8]||(s[8]=r=>c.confirmPassword=r),type:"password",class:"input-dark w-full",placeholder:"请再次输入新密码",required:""},null,512),[[x,c.confirmPassword]])])]),e("div",Cs,[e("button",{type:"button",onClick:E,class:"btn-outline-dark px-6 py-3 rounded-lg font-medium transition-all duration-300 transform hover:-translate-y-1"},s[24]||(s[24]=[e("i",{class:"bi bi-arrow-clockwise mr-2"},null,-1),u(" 重置 ")])),e("button",{type:"submit",disabled:w.value,class:"btn-premium-dark px-6 py-3 rounded-lg font-medium transition-all duration-300 transform hover:-translate-y-1 disabled:opacity-50 disabled:cursor-not-allowed"},[w.value?(n(),l("span",Fs)):(n(),l("i",js)),u(" "+i(w.value?"修改中...":"修改密码"),1)],8,Us)])],32)])):y("",!0)])])])]),A.value?(n(),l("div",As,[e("div",Vs,[s[30]||(s[30]=e("h3",{class:"text-xl font-semibold text-white mb-6 flex items-center gap-3"},[e("i",{class:"bi bi-camera text-cyan-400"}),u(" 上传头像 ")],-1)),e("div",Ls,[e("div",Es,[e("div",zs,[e("input",{id:"avatar-input",type:"file",accept:"image/*",onChange:ye,class:"hidden"},null,32),e("div",{onClick:z,class:"w-32 h-32 border-2 border-dashed border-cyan-500/30 rounded-lg flex items-center justify-center hover:border-cyan-400/50 transition-colors duration-300 cursor-pointer overflow-hidden"},[b.value?(n(),l("img",{key:0,src:b.value,alt:"头像预览",class:"w-full h-full object-cover"},null,8,Bs)):(n(),l("div",Is,s[26]||(s[26]=[e("i",{class:"bi bi-cloud-upload text-3xl text-cyan-400 mb-2 block"},null,-1),e("span",{class:"text-sm text-gray-400"},"点击选择图片",-1)])))]),b.value?(n(),l("button",{key:0,onClick:z,class:"absolute top-0 right-0 bg-cyan-500 text-white rounded-full w-8 h-8 flex items-center justify-center hover:bg-cyan-400 transition-colors duration-200"},s[27]||(s[27]=[e("i",{class:"bi bi-pencil text-xs"},null,-1)]))):y("",!0)])]),m.value?(n(),l("div",Ms,[e("p",Ss,i(m.value.name),1),e("p",Ns,i((m.value.size/1024/1024).toFixed(2))+" MB",1)])):y("",!0),s[29]||(s[29]=e("p",{class:"text-center text-gray-400 text-sm"},[u(" 支持 JPG、PNG、GIF、WebP 格式"),e("br"),u(" 文件大小不超过 2MB ")],-1)),e("div",qs,[e("button",{onClick:B,class:"btn-outline-dark px-6 py-3 rounded-lg font-medium transition-all duration-300 transform hover:-translate-y-1"},s[28]||(s[28]=[e("i",{class:"bi bi-x-circle mr-2"},null,-1),u(" 取消 ")])),e("button",{onClick:ve,disabled:!m.value||k.value,class:"btn-premium-dark px-6 py-3 rounded-lg font-medium transition-all duration-300 transform hover:-translate-y-1 disabled:opacity-50 disabled:cursor-not-allowed"},[k.value?(n(),l("span",Ds)):(n(),l("i",Gs)),u(" "+i(k.value?"上传中...":"确定上传"),1)],8,$s)])])])])):y("",!0)])]}),_:1},8,["is-page-loading","is-data-loading","has-error","error-message","onRetry"])}}}),lt=Ee(Rs,[["__scopeId","data-v-132164ff"]]);export{lt as default};
