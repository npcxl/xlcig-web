# ç”µè„‘è£…æœºæŒ‡å—é¡¹ç›®éƒ¨ç½²æŒ‡å—

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

### åŸºç¡€ç¯å¢ƒ
- **Docker**: 20.0+ (æ¨èä½¿ç”¨ Docker Desktop)
- **Docker Compose**: 2.0+
- **æ“ä½œç³»ç»Ÿ**: Linux/Windows/macOS
- **å†…å­˜**: æœ€ä½ 1GBï¼Œæ¨è 2GB+
- **å­˜å‚¨**: æœ€ä½ 1GB å¯ç”¨ç©ºé—´

## ğŸš€ **æ¨èéƒ¨ç½²æ–¹å¼ï¼šDockerå®¹å™¨åŒ–éƒ¨ç½²**

è¿™æ˜¯æœ€ç®€å•ã€æœ€å¯é çš„éƒ¨ç½²æ–¹å¼ï¼Œé€‚ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚

### Linux/macOS éƒ¨ç½²
```bash
# å…‹éš†é¡¹ç›®23
git clone <your-repo-url>
cd computer-installation-guide

# æ‰§è¡ŒDockeréƒ¨ç½²è„šæœ¬
chmod +x docker-build.sh
./docker-build.sh
```

### Windows éƒ¨ç½²
```powershell
# å…‹éš†é¡¹ç›®
git clone <your-repo-url>
cd computer-installation-guide

# æ‰§è¡ŒDockeréƒ¨ç½²è„šæœ¬
PowerShell -ExecutionPolicy Bypass -File docker-build.ps1
```

### æ‰‹åŠ¨ Docker éƒ¨ç½²
```bash
# 1. åœæ­¢ç°æœ‰å®¹å™¨
docker-compose -f docker-compose.prod.yml down

# 2. æ„å»ºå¹¶å¯åŠ¨
docker-compose -f docker-compose.prod.yml up --build -d

# 3. æŸ¥çœ‹çŠ¶æ€
docker-compose -f docker-compose.prod.yml ps
```

## ğŸ¤– **è‡ªåŠ¨åŒ–éƒ¨ç½²æ–¹æ¡ˆ**

### 1. è‡ªåŠ¨æ›´æ–°éƒ¨ç½²è„šæœ¬

**æ— éœ€æ‰‹åŠ¨gitæ‹‰å–ï¼Œè‡ªåŠ¨æ£€æŸ¥æ›´æ–°å¹¶éƒ¨ç½²ï¼**

#### Linux/macOS è‡ªåŠ¨éƒ¨ç½²
```bash
# è®¾ç½®æ‰§è¡Œæƒé™
chmod +x auto-deploy.sh

# æ£€æŸ¥æ›´æ–°å¹¶è‡ªåŠ¨éƒ¨ç½²
./auto-deploy.sh

# å¼ºåˆ¶é‡æ–°éƒ¨ç½²
./auto-deploy.sh --force

# éƒ¨ç½²æŒ‡å®šåˆ†æ”¯
./auto-deploy.sh --branch develop

# æŒ‡å®šé¡¹ç›®ç›®å½•
./auto-deploy.sh --dir /path/to/project
```

#### Windows è‡ªåŠ¨éƒ¨ç½²
```powershell
# æ£€æŸ¥æ›´æ–°å¹¶è‡ªåŠ¨éƒ¨ç½²
PowerShell -ExecutionPolicy Bypass -File auto-deploy.ps1

# å¼ºåˆ¶é‡æ–°éƒ¨ç½²
PowerShell -ExecutionPolicy Bypass -File auto-deploy.ps1 -Force

# éƒ¨ç½²æŒ‡å®šåˆ†æ”¯
PowerShell -ExecutionPolicy Bypass -File auto-deploy.ps1 -Branch develop

# æŒ‡å®šé¡¹ç›®ç›®å½•
PowerShell -ExecutionPolicy Bypass -File auto-deploy.ps1 -ProjectDir "C:\path\to\project"
```

**åŠŸèƒ½ç‰¹æ€§ï¼š**
- âœ… è‡ªåŠ¨æ£€æŸ¥Gitæ›´æ–°
- âœ… æ™ºèƒ½è·³è¿‡æ— æ›´æ–°çš„éƒ¨ç½²
- âœ… è‡ªåŠ¨å¤‡ä»½å’Œå›æ»šæœºåˆ¶
- âœ… å®Œæ•´çš„å¥åº·æ£€æŸ¥
- âœ… è¯¦ç»†çš„æ—¥å¿—è®°å½•

### 2. Webhook è§¦å‘éƒ¨ç½²

**é€šè¿‡HTTPè¯·æ±‚è¿œç¨‹è§¦å‘éƒ¨ç½²ï¼**

#### å¯åŠ¨WebhookæœåŠ¡
```bash
# è®¾ç½®æ‰§è¡Œæƒé™
chmod +x webhook-deploy.sh

# å¯åŠ¨webhookæœåŠ¡ï¼ˆå‰å°ï¼‰
./webhook-deploy.sh

# åå°è¿è¡Œ
./webhook-deploy.sh --daemon

# è‡ªå®šä¹‰ç«¯å£å’Œä»¤ç‰Œ
./webhook-deploy.sh --port 8080 --token "your-secret-token"

# ç”ŸæˆsystemdæœåŠ¡
sudo ./webhook-deploy.sh --systemd
```

#### è§¦å‘éƒ¨ç½²
```bash
# è§¦å‘mainåˆ†æ”¯éƒ¨ç½²
curl -X POST "http://your-server:9000/deploy?token=your-webhook-secret-token"

# è§¦å‘æŒ‡å®šåˆ†æ”¯éƒ¨ç½²
curl -X POST "http://your-server:9000/deploy?token=your-webhook-secret-token&branch=develop"

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
curl "http://your-server:9000/status"

# å¥åº·æ£€æŸ¥
curl "http://your-server:9000/health"
```

**Webhook APIç«¯ç‚¹ï¼š**
- `POST /deploy?token=TOKEN&branch=BRANCH` - è§¦å‘éƒ¨ç½²
- `GET /status` - æŸ¥çœ‹çŠ¶æ€
- `GET /health` - å¥åº·æ£€æŸ¥

### 3. å®šæ—¶è‡ªåŠ¨æ£€æŸ¥éƒ¨ç½²

**å®šæ—¶æ£€æŸ¥ä»£ç æ›´æ–°ï¼Œå®Œå…¨æ— äººå€¼å®ˆï¼**

```bash
# è®¾ç½®æ‰§è¡Œæƒé™
chmod +x schedule-deploy.sh

# å¯åŠ¨å®šæ—¶æ£€æŸ¥æœåŠ¡ï¼ˆæ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ï¼‰
./schedule-deploy.sh --start

# è‡ªå®šä¹‰æ£€æŸ¥é—´éš”ï¼ˆæ¯10åˆ†é’Ÿï¼‰
./schedule-deploy.sh --start --interval 600

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
./schedule-deploy.sh --status

# åœæ­¢æœåŠ¡
./schedule-deploy.sh --stop

# é‡å¯æœåŠ¡
./schedule-deploy.sh --restart

# æŸ¥çœ‹æ—¥å¿—
tail -f schedule-deploy.log
```

#### ä½¿ç”¨Crontabï¼ˆæ›¿ä»£æ–¹æ¡ˆï¼‰
```bash
# ç”Ÿæˆcrontabé…ç½®
./schedule-deploy.sh --crontab

# æ‰‹åŠ¨æ·»åŠ åˆ°crontabï¼ˆæ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ï¼‰
echo "*/5 * * * * cd $(pwd) && ./schedule-deploy.sh --check-once >> schedule-deploy.log 2>&1" | crontab -

# æŸ¥çœ‹å½“å‰crontab
crontab -l
```

## ğŸ”§ ç”Ÿäº§ç¯å¢ƒé…ç½®

### 1. åŸŸåé…ç½®

å½“å‰é…ç½®çš„åŸŸåï¼š`www.xl-tool.online`

ç›¸å…³é…ç½®æ–‡ä»¶ï¼š
- `nginx.conf` - WebæœåŠ¡å™¨é…ç½®
- `docker-compose.prod.yml` - å®¹å™¨ç¯å¢ƒå˜é‡

### 2. Nginx é…ç½®ç‰¹æ€§

å·²é…ç½®çš„åŠŸèƒ½ï¼š
- é™æ€æ–‡ä»¶æœåŠ¡
- Gzip å‹ç¼©
- ç¼“å­˜ç­–ç•¥
- é”™è¯¯é¡µé¢å¤„ç†
- å®‰å…¨å¤´è®¾ç½®

## ğŸŒ åŸŸåå’ŒSSLé…ç½®

### 1. åŸŸåç»‘å®š
ç¡®ä¿DNSè®°å½•æ­£ç¡®é…ç½®ï¼š
```bash
# æ£€æŸ¥DNSè§£æ
nslookup www.xl-tool.online
dig www.xl-tool.online
```

éœ€è¦æ·»åŠ çš„DNSè®°å½•ï¼š
- **Aè®°å½•**: `www.xl-tool.online` â†’ æ‚¨çš„æœåŠ¡å™¨IP
- **Aè®°å½•**: `xl-tool.online` â†’ æ‚¨çš„æœåŠ¡å™¨IP (å¯é€‰)

### 2. SSL è¯ä¹¦é…ç½®ï¼ˆå¯é€‰ï¼‰
```bash
# å®‰è£… Certbot
sudo apt-get install certbot python3-certbot-nginx

# åœæ­¢å®¹å™¨è·å–è¯ä¹¦
docker-compose -f docker-compose.prod.yml down

# è·å–è¯ä¹¦
sudo certbot certonly --standalone -d www.xl-tool.online -d xl-tool.online

# è¯ä¹¦è·¯å¾„ï¼š/etc/letsencrypt/live/www.xl-tool.online/
```

## ğŸ“Š ç›‘æ§å’Œç®¡ç†

### 1. å®¹å™¨ç®¡ç†
```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker-compose -f docker-compose.prod.yml ps

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
docker-compose -f docker-compose.prod.yml logs -f

# é‡å¯æœåŠ¡
docker-compose -f docker-compose.prod.yml restart

# åœæ­¢æœåŠ¡
docker-compose -f docker-compose.prod.yml down
```

### 2. è‡ªåŠ¨åŒ–è„šæœ¬ç®¡ç†
```bash
# æŸ¥çœ‹è‡ªåŠ¨éƒ¨ç½²çŠ¶æ€
./schedule-deploy.sh --status

# æŸ¥çœ‹webhookæœåŠ¡çŠ¶æ€
curl http://localhost:9000/status

# æŸ¥çœ‹æ‰€æœ‰ç›¸å…³è¿›ç¨‹
ps aux | grep -E "(auto-deploy|webhook|schedule)"

# æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶
ls -la *.log
```

### 3. ç³»ç»Ÿç›‘æ§
```bash
# æŸ¥çœ‹ç³»ç»Ÿèµ„æº
docker stats

# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
df -h

# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
free -h
```

### 4. æ—¥å¿—ç®¡ç†
```bash
# æŸ¥çœ‹nginxè®¿é—®æ—¥å¿—
docker-compose -f docker-compose.prod.yml exec pc-guide-frontend tail -f /var/log/nginx/access.log

# æŸ¥çœ‹nginxé”™è¯¯æ—¥å¿—
docker-compose -f docker-compose.prod.yml exec pc-guide-frontend tail -f /var/log/nginx/error.log

# æŸ¥çœ‹è‡ªåŠ¨éƒ¨ç½²æ—¥å¿—
tail -f auto-deploy.log

# æŸ¥çœ‹å®šæ—¶éƒ¨ç½²æ—¥å¿—
tail -f schedule-deploy.log

# æŸ¥çœ‹webhookæ—¥å¿—
tail -f webhook-deploy.log
```

## ğŸ”’ å®‰å…¨é…ç½®

### 1. é˜²ç«å¢™è®¾ç½®
```bash
# Ubuntu/Debian
sudo ufw allow 22    # SSH
sudo ufw allow 80    # HTTP
sudo ufw allow 443   # HTTPS (å¦‚æœä½¿ç”¨SSL)
sudo ufw allow 9000  # Webhookç«¯å£ (å¯é€‰)
sudo ufw enable

# CentOS/RHEL
sudo firewall-cmd --permanent --add-service=ssh
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https
sudo firewall-cmd --permanent --add-port=9000/tcp  # Webhookç«¯å£
sudo firewall-cmd --reload
```

### 2. Webhookå®‰å…¨
```bash
# ä¿®æ”¹webhookå¯†é’¥
sed -i 's/your-webhook-secret-token/your-new-complex-token/g' webhook-deploy.sh

# é™åˆ¶è®¿é—®IPï¼ˆåœ¨nginxä¸­é…ç½®ï¼‰
# allow 192.168.1.0/24;
# deny all;
```

### 3. Dockerå®‰å…¨
```bash
# å®šæœŸæ¸…ç†æ— ç”¨é•œåƒ
docker system prune -f

# æ›´æ–°é•œåƒ
docker-compose -f docker-compose.prod.yml pull
docker-compose -f docker-compose.prod.yml up -d
```

## ğŸ”„ æ›´æ–°å’Œç»´æŠ¤

### 1. ä»£ç æ›´æ–°
```bash
# ä½¿ç”¨è‡ªåŠ¨éƒ¨ç½²è„šæœ¬ï¼ˆæ¨èï¼‰
./auto-deploy.sh

# æˆ–ä½¿ç”¨å®šæ—¶æ£€æŸ¥æœåŠ¡
./schedule-deploy.sh --check-once

# æˆ–é€šè¿‡webhookè§¦å‘
curl -X POST "http://localhost:9000/deploy?token=your-token"
```

### 2. å®šæœŸç»´æŠ¤
```bash
# å®šæ—¶æ¸…ç†Dockerèµ„æº
echo "0 3 * * 0 docker system prune -f" | crontab -

# å®šæ—¶æ£€æŸ¥æœåŠ¡çŠ¶æ€
echo "0 */6 * * * ./schedule-deploy.sh --status" | crontab -
```

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. ç«¯å£å†²çª
```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
netstat -tlnp | grep 80
# æˆ–
lsof -i :80

# åœæ­¢å ç”¨è¿›ç¨‹
sudo fuser -k 80/tcp
```

#### 2. å®¹å™¨å¯åŠ¨å¤±è´¥
```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
docker-compose -f docker-compose.prod.yml logs

# é‡å»ºå®¹å™¨
docker-compose -f docker-compose.prod.yml down
docker-compose -f docker-compose.prod.yml up --build -d
```

#### 3. è‡ªåŠ¨éƒ¨ç½²å¤±è´¥
```bash
# æŸ¥çœ‹è‡ªåŠ¨éƒ¨ç½²æ—¥å¿—
tail -f auto-deploy.log

# æ‰‹åŠ¨æ£€æŸ¥GitçŠ¶æ€
git status
git fetch origin main

# æ£€æŸ¥DockerçŠ¶æ€
docker ps
docker-compose -f docker-compose.prod.yml ps
```

#### 4. WebhookæœåŠ¡æ— å“åº”
```bash
# æ£€æŸ¥webhookè¿›ç¨‹
ps aux | grep webhook

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep 9000

# é‡å¯webhookæœåŠ¡
pkill -f webhook-deploy.sh
./webhook-deploy.sh --daemon
```

#### 5. åŸŸåæ— æ³•è®¿é—®
```bash
# æ£€æŸ¥DNSè§£æ
nslookup www.xl-tool.online

# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker-compose -f docker-compose.prod.yml ps

# æ£€æŸ¥nginxé…ç½®
docker-compose -f docker-compose.prod.yml exec pc-guide-frontend nginx -t
```

#### 6. ç£ç›˜ç©ºé—´ä¸è¶³
```bash
# æ¸…ç†Dockerèµ„æº
docker system prune -a

# æ¸…ç†æ—¥å¿—
sudo journalctl --vacuum-time=7d

# æ¸…ç†å¤‡ä»½æ–‡ä»¶
find ./backups -type d -mtime +30 -exec rm -rf {} \;
```

## ğŸ“ éƒ¨ç½²æ–‡ä»¶è¯´æ˜

### æ ¸å¿ƒéƒ¨ç½²æ–‡ä»¶
- âœ… `docker-build.sh/ps1` - **ç”Ÿäº§ç¯å¢ƒDockeréƒ¨ç½²è„šæœ¬**
- âœ… `docker-compose.prod.yml` - ç”Ÿäº§ç¯å¢ƒDockeré…ç½®
- âœ… `nginx.conf` - WebæœåŠ¡å™¨é…ç½®  
- âœ… `Dockerfile.frontend` - å‰ç«¯é•œåƒæ„å»º

### ğŸ”¥ è‡ªåŠ¨åŒ–éƒ¨ç½²æ–‡ä»¶ï¼ˆæ–°å¢ï¼‰
- âœ… `auto-deploy.sh/ps1` - **è‡ªåŠ¨æ›´æ–°éƒ¨ç½²è„šæœ¬**
- âœ… `webhook-deploy.sh` - **Webhookè§¦å‘éƒ¨ç½²è„šæœ¬**
- âœ… `schedule-deploy.sh` - **å®šæ—¶æ£€æŸ¥éƒ¨ç½²è„šæœ¬**

### è®¿é—®åœ°å€
- **æœ¬åœ°è®¿é—®**: http://localhost
- **åŸŸåè®¿é—®**: http://www.xl-tool.online (éœ€è¦DNSé…ç½®)
- **HTTPSè®¿é—®**: https://www.xl-tool.online (éœ€è¦SSLè¯ä¹¦)
- **Webhook API**: http://your-server:9000/deploy?token=your-token

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°éƒ¨ç½²é—®é¢˜ï¼š

1. æŸ¥çœ‹å®¹å™¨æ—¥å¿—ï¼š`docker-compose -f docker-compose.prod.yml logs -f`
2. æ£€æŸ¥å®¹å™¨çŠ¶æ€ï¼š`docker-compose -f docker-compose.prod.yml ps`
3. éªŒè¯é…ç½®æ–‡ä»¶ï¼š`docker-compose -f docker-compose.prod.yml config`
4. é‡æ–°æ„å»ºé•œåƒï¼š`docker-compose -f docker-compose.prod.yml build --no-cache`
5. æŸ¥çœ‹è‡ªåŠ¨åŒ–è„šæœ¬æ—¥å¿—ï¼š`tail -f *.log`

## ï¿½ï¿½ ç‰ˆæœ¬ä¿¡æ¯

- **å½“å‰ç‰ˆæœ¬**: 1.0.0
- **åŸŸå**: www.xl-tool.online
- **éƒ¨ç½²æ–¹å¼**: Dockerå®¹å™¨åŒ– + è‡ªåŠ¨åŒ–éƒ¨ç½²
- **æœ€åæ›´æ–°**: 2024å¹´12æœˆ

---

## ğŸ¯ **å¿«é€Ÿå¼€å§‹ï¼ˆä¸‰ç§æ–¹å¼ä»»é€‰å…¶ä¸€ï¼‰**

### æ–¹å¼ä¸€ï¼šä¸€é”®éƒ¨ç½²ï¼ˆæ¨èæ–°ç”¨æˆ·ï¼‰
```bash
./docker-build.sh
```

### æ–¹å¼äºŒï¼šè‡ªåŠ¨åŒ–éƒ¨ç½²ï¼ˆæ¨èæ—¥å¸¸ä½¿ç”¨ï¼‰
```bash
./auto-deploy.sh
```

### æ–¹å¼ä¸‰ï¼šå®Œå…¨è‡ªåŠ¨åŒ–ï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰
```bash
# å¯åŠ¨å®šæ—¶æ£€æŸ¥æœåŠ¡
./schedule-deploy.sh --start

# æˆ–å¯åŠ¨webhookæœåŠ¡
./webhook-deploy.sh --daemon
```


# ä¸€æ¬¡æ€§æ›´æ–°æ‰€æœ‰é…ç½®æ–‡ä»¶
sed -i 's/www\.xl-tool\.online/xia.7788soft.com/g' nginx.conf docker-compose.prod.yml auto-deploy.sh webhook-deploy.sh auto-deploy.ps1

# é‡æ–°éƒ¨ç½²
docker-compose -f docker-compose.prod.yml down
docker-compose -f docker-compose.prod.yml up --build -d

# éªŒè¯é…ç½®
echo "=== nginx.conf ==="
grep server_name nginx.conf
echo "=== docker-compose.prod.yml ==="
grep NGINX_HOST docker-compose.prod.yml

# åœæ­¢ç°æœ‰å®¹å™¨å¹¶é‡æ–°æ„å»ºéƒ¨ç½²
docker-compose -f docker-compose.prod.yml down && docker-compose -f docker-compose.prod.yml up --build -d

# æŸ¥çœ‹ç»“æœ
docker ps && curl http://localhost